<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Prototype v1.7</title>
    <style>
        /* ============================================
           DESIGN SYSTEM v1.1 - Complete Integration
           ============================================ */
        
        :root {
            /* Check-in Themes from Design Library v1.1 */
            --morning-primary: #FF9F43;
            --morning-success: #E8863A;
            --morning-light: #FFB366;
            --morning-bg: #FFF8F0;
            
            --midday-primary: #40B5AD;
            --midday-success: #2C8A82;
            --midday-light: #5EC4BC;
            --midday-bg: #F0FBF9;
            
            --evening-primary: #4A7C59;
            --evening-success: #2D5016;
            --evening-light: #6B9B78;
            --evening-bg: #F0F8F4;
            
            /* Base System Colors */
            --white: #FFFFFF;
            --black: #1C1C1C;
            --midnight-blue: #1B2951;
            --gray-100: #F8F8F8;
            --gray-200: #F5F5F5;
            --gray-300: #E8E8E8;
            --gray-600: #757575;
            
            /* Status Colors */
            --success: #95B99C;
            --warning: #F5C842;
            --error: #E8A5A5;
            --info: #4A90E2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        /* Device Frame */
        .device-frame {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 10px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }
        
        .device-screen {
            width: 100%;
            height: 100%;
            background: var(--white);
            border-radius: 30px;
            overflow: hidden;
            position: relative;
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Navigation Header */
        .nav-header {
            height: 56px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .nav-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--black);
        }
        
        .back-button {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--gray-100);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .back-button:hover {
            background: var(--gray-200);
            transform: scale(1.05);
        }
        
        /* SOS Button in Header */
        .sos-header-button {
            width: 40px;
            height: 32px;
            border-radius: 8px;
            background: var(--error);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .sos-header-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Screens */
        .screen {
            position: absolute;
            top: 100px;
            left: 0;
            right: 0;
            bottom: 84px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 84px;
            background: var(--white);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 20px 24px;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 8px;
            border-radius: 8px;
        }
        
        .nav-item:hover {
            background: var(--gray-100);
        }
        
        .nav-shape {
            width: 24px;
            height: 24px;
        }
        
        .nav-shape.profile {
            width: 28px;
            height: 28px;
        }
        
        /* Default navbar colors - soft black when not selected */
        .nav-shape {
            color: var(--black); /* #1C1C1C */
        }
        
        /* Navbar item colors when active/selected */
        .nav-item:nth-child(1).active .nav-shape {
            color: var(--morning-primary);
        }
        
        .nav-item:nth-child(2).active .nav-shape {
            color: var(--midday-primary);
        }
        
        .nav-item:nth-child(3).active .nav-shape {
            color: var(--evening-primary);
        }
        
        .nav-item:nth-child(4).active .nav-shape {
            color: var(--midnight-blue);
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 500;
            color: var(--black); /* #1C1C1C - soft black when not selected */
        }
        
        .nav-item.active .nav-label {
            font-weight: 600;
        }
        
        .nav-item:nth-child(1).active .nav-label {
            color: var(--morning-primary);
        }
        
        .nav-item:nth-child(2).active .nav-label {
            color: var(--midday-primary);
        }
        
        .nav-item:nth-child(3).active .nav-label {
            color: var(--evening-primary);
        }
        
        .nav-item:nth-child(4).active .nav-label {
            color: var(--midnight-blue);
        }
        
        /* Theme-Aware Buttons */
        .button {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .button.morning {
            background: var(--morning-primary);
            color: white;
        }
        
        .button.morning.success {
            background: var(--morning-success);
        }
        
        .button.midday {
            background: var(--midday-primary);
            color: white;
        }
        
        .button.midday.success {
            background: var(--midday-success);
        }
        
        .button.evening {
            background: var(--evening-primary);
            color: white;
        }
        
        .button.evening.success {
            background: var(--evening-success);
        }
        
        .button.outline {
            background: transparent;
            border: 1px solid var(--gray-300);
            color: var(--black);
        }
        
        .button.crisis {
            background: var(--error);
            color: white;
        }
        
        /* Cards */
        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--gray-200);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .card.morning {
            background: var(--morning-bg);
            border-color: var(--morning-light);
        }
        
        .card.midday {
            background: var(--midday-bg);
            border-color: var(--midday-light);
        }
        
        .card.evening {
            background: var(--evening-bg);
            border-color: var(--evening-light);
        }
        
        .card.clickable {
            cursor: pointer;
        }
        
        .card.clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }
        
        /* Steps Indicator (Dots Only) */
        .steps-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
        }
        
        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray-300);
            transition: all 0.2s ease;
        }
        
        .step-dot.active {
            width: 24px;
            border-radius: 4px;
        }
        
        .step-dot.morning.active {
            background: var(--morning-primary);
        }
        
        .step-dot.midday.active {
            background: var(--midday-primary);
        }
        
        .step-dot.evening.active {
            background: var(--evening-primary);
        }
        
        /* Body Areas List (Simplified) */
        .body-areas-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }
        
        .body-area-item {
            padding: 14px;
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 15px;
        }
        
        .body-area-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .body-area-item.selected {
            background: var(--morning-bg);
            border-color: var(--morning-primary);
            color: var(--morning-primary);
            font-weight: 500;
        }
        
        /* Thought Bubbles */
        .thought-container {
            position: relative;
            height: 200px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .thought-bubble {
            position: absolute;
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 14px;
            cursor: pointer;
            animation: float 15s infinite ease-in-out;
            transition: all 0.3s ease;
        }
        
        .thought-bubble:hover {
            transform: scale(1.05);
            border-color: var(--morning-primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .thought-bubble.acknowledged {
            opacity: 0.5;
            border-style: dashed;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-20px) translateX(10px); }
            50% { transform: translateY(10px) translateX(-10px); }
            75% { transform: translateY(-15px) translateX(-5px); }
        }
        
        /* Breathing Animation - SLOWER */
        .breathing-circle {
            width: 150px;
            height: 150px;
            margin: 40px auto;
            background: radial-gradient(circle, var(--midday-light), var(--midday-primary));
            border-radius: 50%;
            animation: breathe 8s infinite ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }
        
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.3); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Event Logger - VERTICAL LAYOUT */
        .event-logger {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin: 20px 0;
        }
        
        .event-input {
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 12px;
            padding: 16px;
        }
        
        .event-input.pleasant {
            border-color: var(--success);
            background: linear-gradient(to bottom, var(--white), #f0fdf4);
        }
        
        .event-input.unpleasant {
            border-color: var(--warning);
            background: linear-gradient(to bottom, var(--white), #fffbf0);
        }
        
        .event-input h4 {
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--gray-600);
        }
        
        .event-input input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-size: 14px;
        }
        
        /* Crisis Plan Builder */
        .crisis-section {
            background: linear-gradient(135deg, #fff5f5, #ffe0e0);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--error);
        }
        
        .crisis-section h3 {
            color: var(--error);
            margin-bottom: 16px;
            font-size: 18px;
        }
        
        .warning-signs {
            background: var(--white);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .warning-sign {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 8px 0;
            background: var(--gray-100);
            border-radius: 8px;
            font-size: 14px;
            border-left: 3px solid var(--error);
        }
        
        /* Simplified Slider Component */
        .slider-container {
            margin: 24px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .slider-value {
            font-weight: 600;
            color: var(--info);
        }
        
        .slider-track {
            width: 100%;
            height: 24px;
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .slider {
            width: 100%;
            height: 24px;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            outline: none;
            cursor: pointer;
            position: relative;
            z-index: 2;
        }
        
        .slider::-webkit-slider-track {
            width: 100%;
            height: 4px;
            background: var(--gray-200);
            border-radius: 2px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--white);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            border: 2px solid var(--info);
        }
        
        .slider.morning::-webkit-slider-thumb {
            border-color: var(--morning-primary);
        }
        
        .slider.midday::-webkit-slider-thumb {
            border-color: var(--midday-primary);
        }
        
        .slider.evening::-webkit-slider-thumb {
            border-color: var(--evening-primary);
        }
        
        .slider-fill {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 4px;
            border-radius: 2px;
            pointer-events: none;
            transition: width 0.2s ease;
            z-index: 1;
        }
        
        .slider-fill.morning {
            background: var(--morning-primary);
        }
        
        .slider-fill.midday {
            background: var(--midday-primary);
        }
        
        .slider-fill.evening {
            background: var(--evening-primary);
        }
        
        /* Multi-Select Grid */
        .multi-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .select-option {
            padding: 12px;
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .select-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .select-option.selected {
            border-color: var(--info);
            background: var(--gray-100);
        }
        
        .select-option.morning.selected {
            border-color: var(--morning-primary);
            background: var(--morning-bg);
        }
        
        .select-option.midday.selected {
            border-color: var(--midday-primary);
            background: var(--midday-bg);
        }
        
        .select-option.evening.selected {
            border-color: var(--evening-primary);
            background: var(--evening-bg);
        }
        
        /* Onboarding values with theme rotation */
        #onboarding-4 .select-option.selected:nth-child(3n+1) {
            border-color: var(--morning-primary);
            background: var(--morning-bg);
            color: var(--morning-primary);
        }
        
        #onboarding-4 .select-option.selected:nth-child(3n+2) {
            border-color: var(--midday-primary);
            background: var(--midday-bg);
            color: var(--midday-primary);
        }
        
        #onboarding-4 .select-option.selected:nth-child(3n) {
            border-color: var(--evening-primary);
            background: var(--evening-bg);
            color: var(--evening-primary);
        }
        
        /* Stat Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--white);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--gray-200);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--gray-600);
        }
        
        .stat-card.morning {
            background: var(--morning-bg);
            border-color: var(--morning-light);
        }
        
        .stat-card.morning .stat-value {
            color: var(--morning-primary);
        }
        
        .stat-card.midday {
            background: var(--midday-bg);
            border-color: var(--midday-light);
        }
        
        .stat-card.midday .stat-value {
            color: var(--midday-primary);
        }
        
        .stat-card.evening {
            background: var(--evening-bg);
            border-color: var(--evening-light);
        }
        
        .stat-card.evening .stat-value {
            color: var(--evening-primary);
        }
        
        /* Text Areas */
        .textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            transition: all 0.2s ease;
        }
        
        .textarea:focus {
            outline: none;
            border-color: var(--info);
        }
        
        /* Info Box */
        .info-box {
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            font-size: 14px;
        }
        
        .info-box.warning {
            background: var(--warning);
            color: var(--black);
        }
        
        .info-box.success {
            background: var(--success);
            color: var(--white);
        }
        
        .info-box.info {
            background: var(--info);
            color: var(--white);
        }
        
        /* Profile/Settings Screen */
        .profile-section {
            text-align: center;
            padding: 20px 0;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            background: var(--gray-200);
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }
        
        .settings-list {
            margin-top: 24px;
        }
        
        .settings-item {
            padding: 16px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .settings-item:hover {
            background: var(--gray-100);
            transform: translateX(4px);
        }
        
        /* Collapsible Sections */
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 12px 0;
            margin: 24px 0 16px;
            border-bottom: 2px solid var(--gray-200);
            transition: all 0.2s ease;
        }
        
        .collapsible-header:hover {
            color: var(--info);
        }
        
        .collapse-arrow {
            transition: transform 0.3s ease;
            font-size: 16px;
        }
        
        .collapse-arrow.open {
            transform: rotate(180deg);
        }
        
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .collapsible-content.open {
            max-height: 1000px;
            transition: max-height 0.5s ease-in;
        }
        
        /* Onboarding Specific Styles */
        input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        input[type="time"] {
            font-family: inherit;
        }
    </style>
</head>
<body>
    <div class="device-frame">
        <div class="device-screen">
            <!-- Status Bar -->
            <div class="status-bar">
                <span>9:41 AM</span>
                <span>100%</span>
            </div>
            
            <!-- Navigation Header -->
            <div class="nav-header">
                <button class="back-button" id="back-button" onclick="navigateBack()">←</button>
                <h2 id="screen-title" style="flex: 1; text-align: center;">Home</h2>
                <div style="display: flex; align-items: center; min-width: 32px;">
                    <!-- Skip button for onboarding (initially hidden) -->
                    <button class="skip-button" id="skip-button" onclick="skipOnboarding()" style="display: none; padding: 8px 12px; border: none; background: transparent; color: var(--gray-600); font-size: 14px; cursor: pointer;">Skip</button>
                    <!-- SOS Button in Header (moved from floating) -->
                    <button class="sos-header-button" onclick="showScreen('crisis-plan')">SOS</button>
                </div>
            </div>
            
            <!-- Home Screen - Redesigned without stats -->
            <div id="home" class="screen active">
                <h1 style="font-size: 28px; margin-bottom: 8px;">Good morning, Sarah</h1>
                <p style="color: var(--gray-600); margin-bottom: 24px;">Sunday, August 31</p>
                
                <!-- Today's Check-ins (primary focus) -->
                <h3 style="margin-bottom: 16px;">Today's Check-ins</h3>
                
                <div class="card morning clickable" onclick="showScreen('morning-1')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 18px; font-weight: 500; margin-bottom: 4px;">Morning Check-in</div>
                            <div style="font-size: 14px; color: var(--gray-600);">Start with body awareness</div>
                        </div>
                        <div style="font-size: 20px;">→</div>
                    </div>
                </div>
                
                <div class="card midday clickable" onclick="showScreen('midday-1')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 18px; font-weight: 500; margin-bottom: 4px;">Midday Reset</div>
                            <div style="font-size: 14px; color: var(--gray-600);">3-minute breathing space</div>
                        </div>
                        <div style="font-size: 20px;">→</div>
                    </div>
                </div>
                
                <div class="card evening clickable" onclick="showScreen('evening-1')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 18px; font-weight: 500; margin-bottom: 4px;">Evening Reflection</div>
                            <div style="font-size: 14px; color: var(--gray-600);">Process your day</div>
                        </div>
                        <div style="font-size: 20px;">→</div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <h3 style="margin: 24px 0 16px;">Quick Actions</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="card" onclick="showScreen('exercises')" style="cursor: pointer; text-align: center;">
                        <div style="font-size: 14px; font-weight: 500;">Meditate</div>
                    </div>
                    <div class="card" onclick="showScreen('exercises')" style="cursor: pointer; text-align: center;">
                        <div style="font-size: 14px; font-weight: 500;">Breathe</div>
                    </div>
                </div>
                
                <!-- Test Onboarding Link -->
                <div style="margin-top: 24px; text-align: center;">
                    <a href="#" onclick="showScreen('onboarding-1'); return false;" style="color: var(--info); font-size: 12px;">Test Onboarding Flow</a>
                </div>
            </div>
            
            <!-- ONBOARDING FLOW SCREENS -->
            <!-- Onboarding Screen 1: Welcome -->
            <div id="onboarding-1" class="screen">
                <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px 20px;">
                    <!-- Animated Brain Icon -->
                    <div style="width: 120px; height: 120px; background: var(--gray-100); border-radius: 60px; display: flex; align-items: center; justify-content: center; margin-bottom: 32px; animation: breathe 4s infinite ease-in-out;">
                        <svg width="80" height="80" viewBox="0 0 32 32">
                            <defs>
                                <clipPath id="brainClipOnboarding">
                                    <path d="M16 4C20 4 24 6 26 10C28 14 26 18 24 20C26 22 28 26 24 28C20 28 16 26 16 28C16 26 12 28 8 28C4 26 6 22 8 20C6 18 4 14 6 10C8 6 12 4 16 4Z" />
                                </clipPath>
                            </defs>
                            <path d="M16 4C20 4 24 6 26 10C28 14 26 18 24 20C26 22 28 26 24 28C20 28 16 26 16 28C16 26 12 28 8 28C4 26 6 22 8 20C6 18 4 14 6 10C8 6 12 4 16 4Z" 
                                  fill="white" stroke="var(--midnight-blue)" stroke-width="2"/>
                            <g clip-path="url(#brainClipOnboarding)">
                                <rect x="0" y="12.8" width="32" height="19.2" fill="var(--midnight-blue)" />
                                <path d="M0 12.8 Q8 10.8 16 12.8 T32 12.8 L32 13.8 Q24 15.8 16 13.8 T0 13.8 Z" fill="white"/>
                            </g>
                        </svg>
                    </div>
                    
                    <h1 style="font-size: 32px; font-weight: 300; margin-bottom: 16px;">Welcome to FullMind</h1>
                    <p style="font-size: 16px; color: var(--gray-600); line-height: 1.5; margin-bottom: 32px;">
                        Your personal MBCT companion for daily mindfulness and mental wellness
                    </p>
                    
                    <!-- Feature Pills -->
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 40px;">
                        <div style="background: var(--gray-100); padding: 8px 16px; border-radius: 20px; font-size: 13px;">Evidence-based techniques</div>
                        <div style="background: var(--gray-100); padding: 8px 16px; border-radius: 20px; font-size: 13px;">Daily check-ins</div>
                        <div style="background: var(--gray-100); padding: 8px 16px; border-radius: 20px; font-size: 13px;">Pattern insights</div>
                        <div style="background: var(--gray-100); padding: 8px 16px; border-radius: 20px; font-size: 13px;">Complete privacy</div>
                    </div>
                    
                    <button class="button" style="background: var(--info); color: white;" onclick="showScreen('onboarding-2')">Begin Journey</button>
                    <a href="#" onclick="showScreen('home'); return false;" style="color: var(--gray-600); font-size: 14px; margin-top: 12px;">Maybe Later</a>
                </div>
            </div>
            
            <!-- Onboarding Screen 2: PHQ-9 Assessment - Dynamic Container -->
            <div id="onboarding-2" class="screen">
                <!-- Content will be dynamically inserted by JavaScript -->
            </div>
            
            <!-- Onboarding Screen 3: GAD-7 Assessment - Dynamic Container -->
            <div id="onboarding-3" class="screen">
                <!-- Content will be dynamically inserted by JavaScript -->
            </div>
            
            <!-- Onboarding Screen 4: Values Selection -->
            <div id="onboarding-4" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot active" style="background: var(--info);"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <div style="padding: 20px;">
                    <h2 style="font-size: 24px; font-weight: 300; margin-bottom: 16px;">What Matters Most to You?</h2>
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 24px;">
                        Select 3-5 values that guide your life
                    </p>
                    
                    <div id="values-counter" style="background: var(--info); color: white; padding: 8px 16px; border-radius: 20px; display: inline-block; margin-bottom: 20px; font-size: 14px;">
                        Selected: 0/5
                    </div>
                    
                    <div class="multi-select">
                        <div class="select-option" onclick="toggleValueSelection(this)">Connection</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Growth</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Compassion</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Courage</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Peace</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Creativity</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Authenticity</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Adventure</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Security</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Achievement</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Freedom</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Family</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Health</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Learning</div>
                        <div class="select-option" onclick="toggleValueSelection(this)">Service</div>
                    </div>
                    
                    <button id="values-continue-btn" class="button" style="background: var(--gray-300); color: var(--gray-600); cursor: not-allowed;" onclick="if(!this.disabled) showScreen('onboarding-5')" disabled>Continue (Select 3-5 values)</button>
                </div>
            </div>
            
            <!-- Onboarding Screen 5: Notification Preferences -->
            <div id="onboarding-5" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot active" style="background: var(--info);"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <div style="padding: 20px;">
                    <h2 style="font-size: 24px; font-weight: 300; margin-bottom: 16px;">Gentle Reminders</h2>
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 24px;">
                        Set up daily check-in reminders (you can change these anytime)
                    </p>
                    
                    <div style="display: flex; flex-direction: column; gap: 16px; margin-bottom: 24px;">
                        <div style="background: var(--morning-bg); padding: 16px; border-radius: 12px; border: 1px solid var(--morning-light);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 4px;">Morning Check-in</div>
                                    <div style="font-size: 12px; color: var(--gray-600);">Start your day mindfully</div>
                                </div>
                                <input type="time" value="08:00" style="padding: 4px 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
                            </div>
                        </div>
                        
                        <div style="background: var(--midday-bg); padding: 16px; border-radius: 12px; border: 1px solid var(--midday-light);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 4px;">Midday Reset</div>
                                    <div style="font-size: 12px; color: var(--gray-600);">3-minute breathing space</div>
                                </div>
                                <input type="time" value="13:00" style="padding: 4px 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
                            </div>
                        </div>
                        
                        <div style="background: var(--evening-bg); padding: 16px; border-radius: 12px; border: 1px solid var(--evening-light);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 500; margin-bottom: 4px;">Evening Reflection</div>
                                    <div style="font-size: 12px; color: var(--gray-600);">Process your day</div>
                                </div>
                                <input type="time" value="20:00" style="padding: 4px 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
                            </div>
                        </div>
                    </div>
                    
                    <label style="display: flex; align-items: center; padding: 12px; background: var(--gray-100); border-radius: 8px; margin-bottom: 24px; cursor: pointer;">
                        <input type="checkbox" checked style="margin-right: 12px;">
                        <span>Enable notification reminders</span>
                    </label>
                    
                    <button class="button" style="background: var(--info); color: white;" onclick="showScreen('onboarding-6')">Continue</button>
                    <button class="button outline" onclick="showScreen('onboarding-6')">Set up later</button>
                </div>
            </div>
            
            <!-- Onboarding Screen 6: Privacy & Consent -->
            <div id="onboarding-6" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot active" style="background: var(--info);"></div>
                    <div class="step-dot"></div>
                </div>
                
                <div style="padding: 20px;">
                    <h2 style="font-size: 24px; font-weight: 300; margin-bottom: 16px;">Your Privacy Matters</h2>
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 24px;">
                        We take your privacy and data security seriously
                    </p>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
                        <div style="background: var(--gray-100); padding: 16px; border-radius: 12px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">All data stored locally</div>
                            <div style="font-size: 12px; color: var(--gray-600);">Your data never leaves your device</div>
                        </div>
                        
                        <div style="background: var(--gray-100); padding: 16px; border-radius: 12px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Never shared</div>
                            <div style="font-size: 12px; color: var(--gray-600);">We don't share data without permission</div>
                        </div>
                        
                        <div style="background: var(--gray-100); padding: 16px; border-radius: 12px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Anonymous analytics only</div>
                            <div style="font-size: 12px; color: var(--gray-600);">Help us improve without identifying you</div>
                        </div>
                        
                        <div style="background: var(--gray-100); padding: 16px; border-radius: 12px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Delete anytime</div>
                            <div style="font-size: 12px; color: var(--gray-600);">You control your data completely</div>
                        </div>
                    </div>
                    
                    <label style="display: flex; align-items: flex-start; padding: 12px; background: white; border: 2px solid var(--info); border-radius: 8px; margin-bottom: 24px; cursor: pointer;">
                        <input type="checkbox" id="privacy-consent" style="margin-right: 12px; margin-top: 2px;" onchange="togglePrivacyConsent()">
                        <span style="font-size: 14px;">I understand and accept the privacy policy and terms of service</span>
                    </label>
                    
                    <button id="privacy-continue-btn" class="button" style="background: var(--gray-300); color: var(--gray-600); cursor: not-allowed;" onclick="if(!this.disabled) showScreen('onboarding-7')" disabled>Accept & Continue</button>
                </div>
            </div>
            
            <!-- Onboarding Screen 7: Celebration -->
            <div id="onboarding-7" class="screen">
                <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px 20px;">
                    <!-- Success Animation -->
                    <div style="width: 80px; height: 80px; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 32px; animation: pulse 2s infinite;">
                        <div style="color: white; font-size: 40px;">✓</div>
                    </div>
                    
                    <h1 style="font-size: 28px; font-weight: 300; margin-bottom: 16px;">You're All Set!</h1>
                    <p style="font-size: 16px; color: var(--gray-600); line-height: 1.5; margin-bottom: 24px;">
                        Welcome Sarah, your journey to mindfulness begins now
                    </p>
                    
                    <!-- Selected Values Display -->
                    <div style="margin-bottom: 32px;">
                        <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;">Your guiding values:</p>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                            <div style="background: var(--morning-bg); color: var(--morning-primary); padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500;">Connection</div>
                            <div style="background: var(--midday-bg); color: var(--midday-primary); padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500;">Growth</div>
                            <div style="background: var(--evening-bg); color: var(--evening-primary); padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500;">Compassion</div>
                        </div>
                    </div>
                    
                    <!-- Stats Preview -->
                    <div style="background: var(--gray-100); padding: 16px; border-radius: 12px; margin-bottom: 32px; width: 100%;">
                        <p style="font-size: 14px; color: var(--gray-600);">Your first check-in awaits</p>
                    </div>
                    
                    <button class="button" style="background: var(--morning-primary); color: white;" onclick="showScreen('morning-1')">Start Morning Check-in</button>
                    <button class="button outline" onclick="showScreen('home')">Explore the App</button>
                </div>
            </div>
            
            <!-- Exercises Screen - WITH ASSESSMENTS CARD ADDED -->
            <div id="exercises" class="screen">
                <h2 style="margin-bottom: 20px;">Mindfulness Exercises</h2>
                
                <div class="card">
                    <h3>Guided Meditations</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">5, 10, and 20 minute sessions</p>
                </div>
                
                <div class="card">
                    <h3>Breathing Exercises</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">Box breathing, 4-7-8, and more</p>
                </div>
                
                <div class="card">
                    <h3>Mindful Movement</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">Walking meditation and gentle stretches</p>
                </div>
                
                <div class="card">
                    <h3>Thought Work</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">CBT exercises and reframing techniques</p>
                </div>
                
                <!-- NEW ASSESSMENTS CARD -->
                <div class="card clickable" onclick="showScreen('assessments-menu')">
                    <h3>Mental Health Assessments</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">PHQ-9 and GAD-7 self-assessments</p>
                </div>
            </div>
            
            <!-- NEW: Assessments Menu Screen -->
            <div id="assessments-menu" class="screen">
                <h2 style="margin-bottom: 20px;">Mental Health Assessments</h2>
                <p style="color: var(--gray-600); margin-bottom: 24px;">Regular assessments help track your mental health journey</p>
                
                <div class="card clickable" onclick="startAssessment('phq9', 'standalone')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3>PHQ-9 Depression Scale</h3>
                            <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">Assess depression symptoms</p>
                            <div id="phq9-last-taken" style="font-size: 12px; color: var(--info); margin-top: 8px;"></div>
                        </div>
                        <div style="font-size: 20px;">→</div>
                    </div>
                </div>
                
                <div class="card clickable" onclick="startAssessment('gad7', 'standalone')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3>GAD-7 Anxiety Scale</h3>
                            <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">Measure anxiety levels</p>
                            <div id="gad7-last-taken" style="font-size: 12px; color: var(--info); margin-top: 8px;"></div>
                        </div>
                        <div style="font-size: 20px;">→</div>
                    </div>
                </div>
                
                <div class="info-box info">
                    These are self-assessment tools and not diagnostic instruments. Consult a healthcare professional for proper diagnosis and treatment.
                </div>
            </div>
            
            <!-- NEW: Standalone Assessment Screens (reuse containers) -->
            <div id="assessment-phq9" class="screen">
                <!-- Content will be dynamically inserted -->
            </div>
            
            <div id="assessment-gad7" class="screen">
                <!-- Content will be dynamically inserted -->
            </div>
            
            <!-- NEW: Assessment Results Screen -->
            <div id="assessment-results" class="screen">
                <!-- Content will be dynamically inserted -->
            </div>
            
            <!-- Insights Screen -->
            <div id="insights" class="screen">
                <h2 style="margin-bottom: 20px;">Your Insights</h2>
                
                <div class="card">
                    <h3>Mood Patterns</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">Your mood tends to improve after morning check-ins</p>
                </div>
                
                <div class="card">
                    <h3>Values Alignment</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">You're living 78% aligned with your core values</p>
                </div>
                
                <div class="card">
                    <h3>Key Strength</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">Your consistency with evening reflections is exceptional</p>
                </div>
                
                <div class="card">
                    <h3>Your Journey</h3>
                    <p style="color: var(--gray-600); font-size: 14px; margin-top: 8px;">14 day streak • 85% weekly completion • Trending upward</p>
                </div>
            </div>
            
            <!-- Profile Screen - Now includes stats -->
            <div id="profile" class="screen">
                <div class="profile-section">
                    <div class="profile-avatar" style="background: var(--midnight-blue); color: white; font-size: 24px; font-weight: 600;">SJ</div>
                    <h2>Sarah Johnson</h2>
                    <p style="color: var(--gray-600); margin-top: 8px;">Member since August 2025</p>
                </div>
                
                <!-- Your Values - Collapsible (Open by default) -->
                <div class="collapsible-header" onclick="toggleSection('values')">
                    <h3 style="margin: 0;">Your Values</h3>
                    <span class="collapse-arrow open" id="values-arrow">▼</span>
                </div>
                <div class="collapsible-content open" id="values-content">
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; padding: 0 0 16px 0;">
                        <div style="background: var(--morning-bg); color: var(--morning-primary); padding: 10px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid var(--morning-light);">
                            Connection
                        </div>
                        <div style="background: var(--midday-bg); color: var(--midday-primary); padding: 10px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid var(--midday-light);">
                            Growth
                        </div>
                        <div style="background: var(--evening-bg); color: var(--evening-primary); padding: 10px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid var(--evening-light);">
                            Compassion
                        </div>
                        <div style="background: var(--morning-bg); color: var(--morning-primary); padding: 10px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid var(--morning-light);">
                            Creativity
                        </div>
                        <div style="background: var(--midday-bg); color: var(--midday-primary); padding: 10px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid var(--midday-light);">
                            Peace
                        </div>
                    </div>
                </div>
                
                <!-- Your Journey - Collapsible (Closed by default now) -->
                <div class="collapsible-header" onclick="toggleSection('progress')">
                    <h3 style="margin: 0;">Your Journey</h3>
                    <span class="collapse-arrow" id="progress-arrow">▼</span>
                </div>
                <div class="collapsible-content" id="progress-content">
                    <div class="stats-grid">
                        <div class="stat-card morning">
                            <div class="stat-value">14</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                        <div class="stat-card midday">
                            <div class="stat-value">85%</div>
                            <div class="stat-label">Weekly Completion</div>
                        </div>
                        <div class="stat-card evening">
                            <div class="stat-value">7.2</div>
                            <div class="stat-label">Avg Mood</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">42</div>
                            <div class="stat-label">Total Check-ins</div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings - Collapsible (Closed by default) -->
                <div class="collapsible-header" onclick="toggleSection('settings')">
                    <h3 style="margin: 0;">Settings</h3>
                    <span class="collapse-arrow" id="settings-arrow">▼</span>
                </div>
                <div class="collapsible-content" id="settings-content">
                    <div class="settings-list">
                        <div class="settings-item">
                            <span>Notifications</span>
                            <span>→</span>
                        </div>
                        <div class="settings-item">
                            <span>Themes</span>
                            <span>→</span>
                        </div>
                        <div class="settings-item">
                            <span>Data & Privacy</span>
                            <span>→</span>
                        </div>
                        <div class="settings-item" onclick="showScreen('crisis-plan')">
                            <span>Crisis Plan</span>
                            <span>→</span>
                        </div>
                        <div class="settings-item">
                            <span>Help & Support</span>
                            <span>→</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Morning Check-in Flow (7 steps) -->
            <!-- Step 1: Body Scan -->
            <div id="morning-1" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot morning active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">Notice Your Body</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Where do you feel tension or discomfort?
                </p>
                
                <div class="body-areas-list">
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Head</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Neck</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Shoulders</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Chest</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Upper Back</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Lower Back</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Stomach</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Hips</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Legs</div>
                    <div class="body-area-item" onclick="toggleBodyPart(this)">Feet</div>
                </div>
                
                <button class="button morning" onclick="showScreen('morning-2')">Continue</button>
            </div>
            
            <!-- Step 2: Emotion Recognition -->
            <div id="morning-2" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot morning active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">What Emotions Are Here?</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Select all that apply
                </p>
                
                <div class="multi-select">
                    <div class="select-option morning" onclick="toggleSelection(this)">Joy</div>
                    <div class="select-option morning" onclick="toggleSelection(this)">Sadness</div>
                    <div class="select-option morning" onclick="toggleSelection(this)">Anxiety</div>
                    <div class="select-option morning" onclick="toggleSelection(this)">Calm</div>
                    <div class="select-option morning" onclick="toggleSelection(this)">Anger</div>
                    <div class="select-option morning" onclick="toggleSelection(this)">Gratitude</div>
                    <div class="select-option morning" onclick="toggleSelection(this)">Fear</div>
                    <div class="select-option morning" onclick="toggleSelection(this)">Hope</div>
                </div>
                
                <button class="button morning" onclick="showScreen('morning-3')">Continue</button>
            </div>
            
            <!-- Step 3: Thought Observation -->
            <div id="morning-3" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot morning active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">What Thoughts Are Visiting?</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Tap to acknowledge thoughts without attaching to them
                </p>
                
                <div class="thought-container">
                    <div class="thought-bubble" style="top: 20px; left: 20px;" onclick="acknowledgeThought(this)">
                        I have so much to do
                    </div>
                    <div class="thought-bubble" style="top: 60px; right: 30px;" onclick="acknowledgeThought(this)">
                        What if I fail?
                    </div>
                    <div class="thought-bubble" style="bottom: 40px; left: 40px;" onclick="acknowledgeThought(this)">
                        I'm not good enough
                    </div>
                    <div class="thought-bubble" style="bottom: 20px; right: 20px;" onclick="acknowledgeThought(this)">
                        Today will be difficult
                    </div>
                </div>
                
                <button class="button morning" onclick="showScreen('morning-4')">Continue</button>
            </div>
            
            <!-- Step 4: Physical Metrics with Simplified Sliders -->
            <div id="morning-4" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot morning active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">How Are You Feeling?</h2>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Sleep Quality</span>
                        <span class="slider-value">7</span>
                    </div>
                    <div class="slider-track">
                        <div class="slider-fill morning" style="width: 70%;"></div>
                        <input type="range" class="slider morning" min="1" max="10" value="7" oninput="updateSliderValue(this)">
                    </div>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Energy Level</span>
                        <span class="slider-value">6</span>
                    </div>
                    <div class="slider-track">
                        <div class="slider-fill morning" style="width: 60%;"></div>
                        <input type="range" class="slider morning" min="1" max="10" value="6" oninput="updateSliderValue(this)">
                    </div>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Anxiety Level</span>
                        <span class="slider-value">4</span>
                    </div>
                    <div class="slider-track">
                        <div class="slider-fill morning" style="width: 40%;"></div>
                        <input type="range" class="slider morning" min="1" max="10" value="4" oninput="updateSliderValue(this)">
                    </div>
                </div>
                
                <button class="button morning" onclick="showScreen('morning-5')">Continue</button>
            </div>
            
            <!-- Step 5: Values & Intention -->
            <div id="morning-5" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot morning active"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">What Matters Most Today?</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Choose your guiding value
                </p>
                
                <div class="multi-select">
                    <div class="select-option morning" onclick="selectSingle(this)">Connection</div>
                    <div class="select-option morning" onclick="selectSingle(this)">Growth</div>
                    <div class="select-option morning" onclick="selectSingle(this)">Compassion</div>
                    <div class="select-option morning" onclick="selectSingle(this)">Courage</div>
                    <div class="select-option morning" onclick="selectSingle(this)">Peace</div>
                    <div class="select-option morning" onclick="selectSingle(this)">Creativity</div>
                </div>
                
                <div style="margin-top: 24px;">
                    <label style="font-size: 14px; color: var(--gray-600);">Set your intention:</label>
                    <textarea class="textarea" placeholder="Today I will..."></textarea>
                </div>
                
                <button class="button morning" onclick="showScreen('morning-6')">Continue</button>
            </div>
            
            <!-- Step 6: Dream Journal (Replaced "What's Alive") -->
            <div id="morning-6" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot morning active"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">Dream Journal</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Any dreams to record from last night?
                </p>
                
                <textarea class="textarea" placeholder="Describe any dreams you remember..." style="min-height: 150px;"></textarea>
                
                <div class="info-box info" style="margin-top: 16px;">
                    Recording dreams can reveal patterns and insights about your subconscious
                </div>
                
                <button class="button morning success" onclick="completeCheckIn('morning')">Complete Morning Check-in</button>
            </div>
            
            <!-- Midday Reset Flow -->
            <div id="midday-1" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot midday active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">Step 1: Awareness</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    What's here right now? (1 minute)
                </p>
                
                <div class="card midday">
                    <h4 style="margin-bottom: 12px;">How are you feeling?</h4>
                    <div class="multi-select">
                        <div class="select-option midday" onclick="toggleSelection(this)">Stressed</div>
                        <div class="select-option midday" onclick="toggleSelection(this)">Calm</div>
                        <div class="select-option midday" onclick="toggleSelection(this)">Tired</div>
                        <div class="select-option midday" onclick="toggleSelection(this)">Focused</div>
                        <div class="select-option midday" onclick="toggleSelection(this)">Anxious</div>
                        <div class="select-option midday" onclick="toggleSelection(this)">Content</div>
                    </div>
                </div>
                
                <button class="button midday" onclick="showScreen('midday-2')">Continue to Breathing</button>
            </div>
            
            <div id="midday-2" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot midday active"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">Step 2: Gathering</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Focus on your breath (1 minute)
                </p>
                
                <div class="breathing-circle">
                    Breathe
                </div>
                
                <p style="text-align: center; color: var(--gray-600); margin: 20px;">
                    Follow the circle as it expands and contracts
                </p>
                
                <button class="button midday" onclick="showScreen('midday-3')">Continue</button>
            </div>
            
            <!-- Step 3: Expanding with Vertical Layout -->
            <div id="midday-3" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot midday active"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">Step 3: Expanding</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Widen your awareness (1 minute)
                </p>
                
                <div class="event-logger">
                    <div class="event-input pleasant">
                        <h4>One pleasant thing today:</h4>
                        <input type="text" placeholder="Something good that happened...">
                    </div>
                    <div class="event-input unpleasant">
                        <h4>One difficult thing today:</h4>
                        <input type="text" placeholder="Something challenging...">
                    </div>
                </div>
                
                <div class="card midday" style="margin-top: 20px;">
                    <h4 style="margin-bottom: 12px;">What do you need right now?</h4>
                    <div class="multi-select">
                        <div class="select-option midday" onclick="selectSingle(this)">Rest</div>
                        <div class="select-option midday" onclick="selectSingle(this)">Movement</div>
                        <div class="select-option midday" onclick="selectSingle(this)">Connection</div>
                        <div class="select-option midday" onclick="selectSingle(this)">Focus</div>
                        <div class="select-option midday" onclick="selectSingle(this)">Compassion</div>
                        <div class="select-option midday" onclick="selectSingle(this)">Space</div>
                    </div>
                </div>
                
                <button class="button midday success" onclick="completeCheckIn('midday')">Complete Midday Reset</button>
            </div>
            
            <!-- Evening Reflection Flow - COMPLETE 4 STEPS -->
            <!-- Step 1: Day Review (Improved) -->
            <div id="evening-1" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot evening active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">How Was Your Day?</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Rate different aspects of today
                </p>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Overall Mood</span>
                        <span class="slider-value">7</span>
                    </div>
                    <div class="slider-track">
                        <div class="slider-fill evening" style="width: 70%;"></div>
                        <input type="range" class="slider evening" min="1" max="10" value="7" oninput="updateSliderValue(this)">
                    </div>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Energy Management</span>
                        <span class="slider-value">6</span>
                    </div>
                    <div class="slider-track">
                        <div class="slider-fill evening" style="width: 60%;"></div>
                        <input type="range" class="slider evening" min="1" max="10" value="6" oninput="updateSliderValue(this)">
                    </div>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Values Alignment</span>
                        <span class="slider-value">8</span>
                    </div>
                    <div class="slider-track">
                        <div class="slider-fill evening" style="width: 80%;"></div>
                        <input type="range" class="slider evening" min="1" max="10" value="8" oninput="updateSliderValue(this)">
                    </div>
                </div>
                
                <button class="button evening" onclick="showScreen('evening-2')">Continue</button>
            </div>
            
            <!-- Step 2: Pleasant/Unpleasant Events -->
            <div id="evening-2" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot evening active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">Notice Without Judging</h2>
                
                <div class="event-logger">
                    <div class="event-input pleasant">
                        <h4>What brought joy today?</h4>
                        <input type="text" placeholder="A pleasant moment...">
                        <input type="text" placeholder="Another good thing..." style="margin-top: 8px;">
                    </div>
                    <div class="event-input unpleasant">
                        <h4>What was difficult?</h4>
                        <input type="text" placeholder="A challenging moment...">
                        <input type="text" placeholder="Another difficulty..." style="margin-top: 8px;">
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <label style="font-size: 14px; color: var(--gray-600);">What did you learn?</label>
                    <textarea class="textarea" placeholder="Insights from today..."></textarea>
                </div>
                
                <button class="button evening" onclick="showScreen('evening-3')">Continue</button>
            </div>
            
            <!-- Step 3: Thought Patterns -->
            <div id="evening-3" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot evening active"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">Did Any Patterns Visit Today?</h2>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                    Select any that apply
                </p>
                
                <div class="multi-select">
                    <div class="select-option evening" onclick="toggleSelection(this)">Catastrophizing</div>
                    <div class="select-option evening" onclick="toggleSelection(this)">All-or-Nothing</div>
                    <div class="select-option evening" onclick="toggleSelection(this)">Mind Reading</div>
                    <div class="select-option evening" onclick="toggleSelection(this)">Should Statements</div>
                    <div class="select-option evening" onclick="toggleSelection(this)">Personalization</div>
                    <div class="select-option evening" onclick="toggleSelection(this)">Overgeneralization</div>
                </div>
                
                <button class="button evening" onclick="showScreen('evening-4')">Continue</button>
            </div>
            
            <!-- Step 4: Tomorrow Preparation -->
            <div id="evening-4" class="screen">
                <div class="steps-indicator">
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot evening active"></div>
                </div>
                
                <h2 style="text-align: center; margin: 20px 0;">Prepare for Tomorrow</h2>
                
                <div class="card evening">
                    <h4 style="margin-bottom: 12px;">One thing to remember:</h4>
                    <textarea class="textarea" placeholder="A note to tomorrow's self..."></textarea>
                </div>
                
                <div class="card evening">
                    <h4 style="margin-bottom: 12px;">Tomorrow's intention:</h4>
                    <div class="multi-select">
                        <div class="select-option evening" onclick="selectSingle(this)">Rest Well</div>
                        <div class="select-option evening" onclick="selectSingle(this)">Be Gentle</div>
                        <div class="select-option evening" onclick="selectSingle(this)">Stay Present</div>
                        <div class="select-option evening" onclick="selectSingle(this)">Trust Yourself</div>
                    </div>
                </div>
                
                <button class="button evening success" onclick="completeCheckIn('evening')">Complete Evening Reflection</button>
            </div>
            
            <!-- Crisis Plan Builder -->
            <div id="crisis-plan" class="screen">
                <div class="crisis-section">
                    <h3>Crisis Prevention Plan</h3>
                    <p style="margin-bottom: 16px; font-size: 14px;">
                        Let's create your safety plan together
                    </p>
                    
                    <div class="warning-signs">
                        <h4 style="margin-bottom: 12px;">My Warning Signs:</h4>
                        <div class="warning-sign">Isolating from others</div>
                        <div class="warning-sign">Sleep disruption</div>
                        <div class="warning-sign">Negative self-talk increases</div>
                        <button class="button outline" style="margin-top: 8px;">+ Add Warning Sign</button>
                    </div>
                    
                    <div class="card" style="background: var(--white); margin-top: 16px;">
                        <h4 style="margin-bottom: 12px;">Coping Strategies:</h4>
                        <ul style="padding-left: 20px; font-size: 14px; line-height: 1.8;">
                            <li>Take 10 deep breaths</li>
                            <li>Call my support person</li>
                            <li>Use grounding techniques (5-4-3-2-1)</li>
                            <li>Go for a walk</li>
                        </ul>
                    </div>
                    
                    <div class="card" style="background: var(--white); margin-top: 16px;">
                        <h4 style="margin-bottom: 12px;">Emergency Contacts:</h4>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div><strong>Therapist:</strong> Dr. Smith (555-0123)</div>
                            <div><strong>Crisis Line:</strong> 988</div>
                            <div><strong>Trusted Friend:</strong> Alex (555-0456)</div>
                        </div>
                    </div>
                    
                    <button class="button crisis" onclick="saveCrisisPlan()">Save Crisis Plan</button>
                    <button class="button outline" onclick="showScreen('home')">Back to Home</button>
                </div>
            </div>
            
            <!-- Bottom Navigation - Profile Added, Check-ins Removed -->
            <div class="bottom-nav">
                <div class="nav-item active" onclick="setActiveNav(this); showScreen('home')">
                    <svg class="nav-shape" viewBox="0 0 24 24">
                        <path d="M12 2 L2 12 L12 22 L22 12 Z" fill="currentColor"/>
                    </svg>
                    <span class="nav-label">Home</span>
                </div>
                <div class="nav-item" onclick="setActiveNav(this); showScreen('exercises')">
                    <svg class="nav-shape" viewBox="0 0 24 24">
                        <path d="M12 2 L15 9 L22 9 L17 14 L19 22 L12 18 L5 22 L7 14 L2 9 L9 9 Z" fill="currentColor"/>
                    </svg>
                    <span class="nav-label">Exercises</span>
                </div>
                <div class="nav-item" onclick="setActiveNav(this); showScreen('insights')">
                    <svg class="nav-shape" viewBox="0 0 24 24">
                        <path d="M12 2 L22 22 L2 22 Z" fill="currentColor"/>
                    </svg>
                    <span class="nav-label">Insights</span>
                </div>
                <div class="nav-item" onclick="setActiveNav(this); showScreen('profile')">
                    <svg class="nav-shape profile" viewBox="0 0 24 24">
                        <defs>
                            <clipPath id="brainClipNav">
                                <path d="M12 2C15.5 2 19 4 20.5 7C22 10.5 20.5 14 18.5 15.5C20.5 17 22 20.5 18.5 22C15 22 12 20 12 22C12 20 9 22 5.5 22C2 20.5 3.5 17 5.5 15.5C3.5 14 2 10.5 3.5 7C5 4 8.5 2 12 2Z" />
                            </clipPath>
                        </defs>
                        <path d="M12 2C15.5 2 19 4 20.5 7C22 10.5 20.5 14 18.5 15.5C20.5 17 22 20.5 18.5 22C15 22 12 20 12 22C12 20 9 22 5.5 22C2 20.5 3.5 17 5.5 15.5C3.5 14 2 10.5 3.5 7C5 4 8.5 2 12 2Z" 
                              fill="white" stroke="currentColor" stroke-width="1.5"/>
                        <g clip-path="url(#brainClipNav)">
                            <rect x="0" y="11.2" width="24" height="13.2" fill="currentColor" />
                        </g>
                    </svg>
                    <span class="nav-label">Profile</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Assessment Data and State Management
        const assessments = {
            phq9: {
                title: "Understanding Your Current State",
                subtitle: "Over the last 2 weeks, how often have you been bothered by:",
                questions: [
                    "Little interest or pleasure in doing things",
                    "Feeling down, depressed, or hopeless",
                    "Trouble falling or staying asleep, or sleeping too much",
                    "Feeling tired or having little energy",
                    "Poor appetite or overeating",
                    "Feeling bad about yourself — or that you are a failure or have let yourself or your family down",
                    "Trouble concentrating on things, such as reading the newspaper or watching television",
                    "Moving or speaking so slowly that other people could have noticed? Or the opposite — being so fidgety or restless that you have been moving around a lot more than usual",
                    "Thoughts that you would be better off dead or of hurting yourself in some way"
                ],
                answers: new Array(9).fill(null),
                currentQuestion: 0
            },
            gad7: {
                title: "Anxiety Assessment", 
                subtitle: "Over the last 2 weeks, how often have you been bothered by:",
                questions: [
                    "Feeling nervous, anxious, or on edge",
                    "Not being able to stop or control worrying",
                    "Worrying too much about different things",
                    "Trouble relaxing",
                    "Being so restless that it's hard to sit still",
                    "Becoming easily annoyed or irritable",
                    "Feeling afraid as if something awful might happen"
                ],
                answers: new Array(7).fill(null),
                currentQuestion: 0
            }
        };

        // Response options (same for both assessments)
        const responseOptions = [
            { value: 0, label: "Not at all" },
            { value: 1, label: "Several days" },
            { value: 2, label: "More than half the days" },
            { value: 3, label: "Nearly every day" }
        ];
        
        // Assessment history storage
        const getAssessmentHistory = (type) => {
            return JSON.parse(localStorage.getItem(`${type}_history`) || '[]');
        };
        
        const saveAssessmentResult = (type, score) => {
            const history = getAssessmentHistory(type);
            const result = {
                score: score,
                date: new Date().toISOString(),
                severity: getSeverityLevel(type, score)
            };
            history.push(result);
            localStorage.setItem(`${type}_history`, JSON.stringify(history));
            return result;
        };
        
        const getSeverityLevel = (type, score) => {
            if (type === 'phq9') {
                if (score <= 4) return 'Minimal';
                if (score <= 9) return 'Mild';
                if (score <= 14) return 'Moderate';
                if (score <= 19) return 'Moderately Severe';
                return 'Severe';
            } else { // GAD-7
                if (score <= 4) return 'Minimal';
                if (score <= 9) return 'Mild';
                if (score <= 14) return 'Moderate';
                return 'Severe';
            }
        };
        
        // Start assessment with context
        function startAssessment(type, context = 'standalone') {
            const assessment = assessments[type];
            assessment.answers = new Array(assessment.questions.length).fill(null);
            assessment.currentQuestion = 0;
            
            const screenId = context === 'onboarding' 
                ? (type === 'phq9' ? 'onboarding-2' : 'onboarding-3')
                : `assessment-${type}`;
                
            showScreen(screenId);
        }

        // Initialize assessment screen
        function initAssessment(type, context = 'onboarding') {
            const assessment = assessments[type];
            assessment.currentQuestion = 0;
            updateAssessmentDisplay(type, context);
        }

        // Update display for current question
        function updateAssessmentDisplay(type, context = 'onboarding') {
            const assessment = assessments[type];
            const container = document.getElementById(`${type}-container`);
            if (!container) return;
            
            const questionNum = assessment.currentQuestion + 1;
            const totalQuestions = assessment.questions.length;
            
            // Update progress indicator
            const progressText = container.querySelector('.question-progress');
            if (progressText) {
                progressText.textContent = `Question ${questionNum} of ${totalQuestions}`;
            }
            
            // Update question text
            const questionText = container.querySelector('.question-text');
            if (questionText) {
                questionText.textContent = assessment.questions[assessment.currentQuestion];
            }
            
            // Clear previous selection and set if answer exists
            const radioInputs = container.querySelectorAll('input[type="radio"]');
            radioInputs.forEach(input => {
                input.checked = false;
                if (assessment.answers[assessment.currentQuestion] !== null) {
                    if (parseInt(input.value) === assessment.answers[assessment.currentQuestion]) {
                        input.checked = true;
                    }
                }
            });
            
            // Update navigation buttons
            const prevBtn = container.querySelector('.prev-question-btn');
            const nextBtn = container.querySelector('.next-question-btn');
            
            if (prevBtn) {
                prevBtn.style.display = assessment.currentQuestion === 0 ? 'none' : 'block';
            }
            
            if (nextBtn) {
                if (questionNum === totalQuestions) {
                    nextBtn.textContent = 'Complete Assessment';
                    nextBtn.onclick = () => completeAssessment(type, context);
                } else {
                    nextBtn.textContent = 'Next Question';
                    nextBtn.onclick = () => nextAssessmentQuestion(type, context);
                }
            }
        }

        // Handle answer selection
        function selectAssessmentAnswer(type, value, context = 'onboarding') {
            const assessment = assessments[type];
            assessment.answers[assessment.currentQuestion] = parseInt(value);
            
            // Enable next button
            const container = document.getElementById(`${type}-container`);
            const nextBtn = container.querySelector('.next-question-btn');
            if (nextBtn) {
                nextBtn.disabled = false;
                nextBtn.style.background = 'var(--info)';
                nextBtn.style.color = 'white';
                nextBtn.style.cursor = 'pointer';
            }
        }

        // Navigate to next question
        function nextAssessmentQuestion(type, context = 'onboarding') {
            const assessment = assessments[type];
            
            // Check if answer selected
            if (assessment.answers[assessment.currentQuestion] === null) {
                alert('Please select an answer before continuing');
                return;
            }
            
            if (assessment.currentQuestion < assessment.questions.length - 1) {
                assessment.currentQuestion++;
                updateAssessmentDisplay(type, context);
            }
        }

        // Navigate to previous question
        function prevAssessmentQuestion(type, context = 'onboarding') {
            const assessment = assessments[type];
            if (assessment.currentQuestion > 0) {
                assessment.currentQuestion--;
                updateAssessmentDisplay(type, context);
            }
        }

        // Calculate total score
        function calculateScore(type) {
            const assessment = assessments[type];
            return assessment.answers.reduce((sum, answer) => sum + (answer || 0), 0);
        }

        // Complete assessment and move to next screen
        function completeAssessment(type, context = 'onboarding') {
            const assessment = assessments[type];
            
            // Check all questions answered
            if (assessment.answers.includes(null)) {
                alert('Please answer all questions before continuing');
                return;
            }
            
            const score = calculateScore(type);
            
            if (context === 'onboarding') {
                // Original onboarding logic
                localStorage.setItem(`${type}_score`, score);
                
                if (type === 'phq9') {
                    showScreen('onboarding-3'); // Move to GAD-7
                    initAssessment('gad7', 'onboarding');
                } else if (type === 'gad7') {
                    const phq9Score = parseInt(localStorage.getItem('phq9_score') || 0);
                    const riskLevel = determineRiskLevel(phq9Score, score);
                    localStorage.setItem('risk_level', riskLevel);
                    showScreen('onboarding-4'); // Move to values selection
                }
            } else {
                // Standalone assessment completion
                const result = saveAssessmentResult(type, score);
                showAssessmentResults(type, result);
            }
        }
        
        // Show assessment results
        function showAssessmentResults(type, result) {
            const resultsScreen = document.getElementById('assessment-results');
            const title = type === 'phq9' ? 'PHQ-9 Depression Scale' : 'GAD-7 Anxiety Scale';
            const history = getAssessmentHistory(type);
            
            resultsScreen.innerHTML = `
                <div style="padding: 20px;">
                    <h2 style="text-align: center; margin-bottom: 20px;">${title} Results</h2>
                    
                    <div class="card" style="background: var(--info); color: white; text-align: center; padding: 24px;">
                        <div style="font-size: 48px; font-weight: bold;">${result.score}</div>
                        <div style="font-size: 20px; margin-top: 8px;">${result.severity} Severity</div>
                    </div>
                    
                    <div style="margin-top: 24px;">
                        <h3>Your Progress</h3>
                        <div style="display: flex; gap: 8px; overflow-x: auto; padding: 12px 0;">
                            ${history.slice(-5).map(h => `
                                <div class="card" style="min-width: 100px; text-align: center; flex-shrink: 0;">
                                    <div style="font-size: 20px; font-weight: bold; color: var(--info);">${h.score}</div>
                                    <div style="font-size: 12px; color: var(--gray-600); margin-top: 4px;">${h.severity}</div>
                                    <div style="font-size: 10px; color: var(--gray-600); margin-top: 4px;">
                                        ${new Date(h.date).toLocaleDateString()}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="info-box info" style="margin-top: 20px;">
                        Remember: These are self-assessment tools. Please consult with a healthcare professional for proper diagnosis and treatment.
                    </div>
                    
                    <button class="button" style="background: var(--info); color: white; margin-top: 24px;" 
                            onclick="showScreen('assessments-menu')">
                        Take Another Assessment
                    </button>
                    <button class="button outline" onclick="showScreen('exercises')">
                        Back to Exercises
                    </button>
                </div>
            `;
            
            showScreen('assessment-results');
        }

        // Determine risk level based on scores
        function determineRiskLevel(phq9Score, gad7Score) {
            // PHQ-9 Severity: 0-4 minimal, 5-9 mild, 10-14 moderate, 15-19 moderately severe, 20-27 severe
            // GAD-7 Severity: 0-4 minimal, 5-9 mild, 10-14 moderate, 15-21 severe
            
            if (phq9Score >= 20 || gad7Score >= 15) {
                return 'severe';
            } else if (phq9Score >= 15 || gad7Score >= 10) {
                return 'moderate';
            } else if (phq9Score >= 5 || gad7Score >= 5) {
                return 'mild';
            }
            return 'minimal';
        }

        // HTML Structure for Dynamic Assessment Display
        function getAssessmentHTML(type, context = 'onboarding') {
            const assessment = assessments[type];
            const isOnboarding = context === 'onboarding';
            
            return `
                <div id="${type}-container">
                    ${isOnboarding ? `
                        <div class="steps-indicator">
                            ${type === 'phq9' ? `
                                <div class="step-dot"></div>
                                <div class="step-dot active" style="background: var(--info);"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            ` : `
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active" style="background: var(--info);"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            `}
                        </div>
                    ` : ''}
                    
                    <div style="padding: 20px;">
                        <h2 style="font-size: 24px; font-weight: 300; margin-bottom: 16px;">${assessment.title}</h2>
                        <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 24px;">
                            ${assessment.subtitle}
                        </p>
                        
                        <div style="background: var(--gray-100); padding: 20px; border-radius: 12px; margin-bottom: 24px;">
                            <p class="question-text" style="font-size: 16px; margin-bottom: 20px; font-weight: 500;">
                                ${assessment.questions[0]}
                            </p>
                            
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                ${responseOptions.map(option => `
                                    <label style="display: flex; align-items: center; padding: 12px; background: white; border: 2px solid var(--gray-300); border-radius: 8px; cursor: pointer;">
                                        <input type="radio" name="${type}_current" value="${option.value}" 
                                               style="margin-right: 12px;"
                                               onchange="selectAssessmentAnswer('${type}', this.value, '${context}')">
                                        <span>${option.label}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="question-progress" style="font-size: 12px; color: var(--gray-600); margin-bottom: 20px;">
                            Question 1 of ${assessment.questions.length}
                        </div>
                        
                        <div style="display: flex; gap: 12px;">
                            <button class="button outline prev-question-btn" 
                                    style="display: none; flex: 1;" 
                                    onclick="prevAssessmentQuestion('${type}', '${context}')">
                                Previous
                            </button>
                            <button class="button next-question-btn" 
                                    style="background: var(--gray-300); color: var(--gray-600); flex: 1;" 
                                    onclick="nextAssessmentQuestion('${type}', '${context}')"
                                    disabled>
                                Next Question
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Update assessments menu with last taken dates
        function updateAssessmentsMenu() {
            const phq9History = getAssessmentHistory('phq9');
            const gad7History = getAssessmentHistory('gad7');
            
            const phq9LastTaken = document.getElementById('phq9-last-taken');
            const gad7LastTaken = document.getElementById('gad7-last-taken');
            
            if (phq9LastTaken && phq9History.length > 0) {
                const lastDate = new Date(phq9History[phq9History.length - 1].date);
                phq9LastTaken.textContent = `Last taken: ${lastDate.toLocaleDateString()}`;
            }
            
            if (gad7LastTaken && gad7History.length > 0) {
                const lastDate = new Date(gad7History[gad7History.length - 1].date);
                gad7LastTaken.textContent = `Last taken: ${lastDate.toLocaleDateString()}`;
            }
        }
        
        // Screen Navigation
        let screenHistory = ['home'];
        let currentScreenId = 'home';
        
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show target screen
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                screenHistory.push(screenId);
                currentScreenId = screenId;
                
                // Update header title
                updateHeaderTitle(screenId);
                
                // Hide bottom nav during onboarding
                const bottomNav = document.querySelector('.bottom-nav');
                if (screenId.startsWith('onboarding-')) {
                    bottomNav.style.display = 'none';
                } else {
                    bottomNav.style.display = 'flex';
                }
                
                // Initialize assessments when entering those screens
                if (screenId === 'onboarding-2') {
                    initAssessment('phq9', 'onboarding');
                    document.getElementById('onboarding-2').innerHTML = getAssessmentHTML('phq9', 'onboarding');
                } else if (screenId === 'onboarding-3') {
                    initAssessment('gad7', 'onboarding');
                    document.getElementById('onboarding-3').innerHTML = getAssessmentHTML('gad7', 'onboarding');
                } else if (screenId === 'assessment-phq9') {
                    initAssessment('phq9', 'standalone');
                    document.getElementById('assessment-phq9').innerHTML = getAssessmentHTML('phq9', 'standalone');
                } else if (screenId === 'assessment-gad7') {
                    initAssessment('gad7', 'standalone');
                    document.getElementById('assessment-gad7').innerHTML = getAssessmentHTML('gad7', 'standalone');
                } else if (screenId === 'assessments-menu') {
                    updateAssessmentsMenu();
                }
            }
        }
        
        function navigateBack() {
            if (screenHistory.length > 1) {
                screenHistory.pop();
                const previousScreen = screenHistory[screenHistory.length - 1];
                showScreen(previousScreen);
            }
        }
        
        function updateHeaderTitle(screenId) {
            const titleElement = document.getElementById('screen-title');
            const backButton = document.getElementById('back-button');
            const sosButton = document.querySelector('.sos-header-button');
            const skipButton = document.getElementById('skip-button');
            
            // Hide back button on home screen and welcome screen
            if (screenId === 'home' || screenId === 'onboarding-1') {
                backButton.style.visibility = 'hidden';
            } else {
                backButton.style.visibility = 'visible';
            }
            
            // Hide SOS button during onboarding, show skip button for certain onboarding screens
            if (screenId.startsWith('onboarding-')) {
                sosButton.style.display = 'none';
                // Show skip on screens 2-5 (not on welcome, privacy, or celebration)
                if (['onboarding-2', 'onboarding-3', 'onboarding-4', 'onboarding-5'].includes(screenId)) {
                    skipButton.style.display = 'block';
                } else {
                    skipButton.style.display = 'none';
                }
            } else {
                sosButton.style.display = 'flex';
                skipButton.style.display = 'none';
            }
            
            const titles = {
                'home': 'Home',
                'exercises': 'Exercises',
                'insights': 'Insights',
                'profile': 'Profile',
                'morning-1': 'Morning Check-in',
                'morning-2': 'Morning Check-in',
                'morning-3': 'Morning Check-in',
                'morning-4': 'Morning Check-in',
                'morning-5': 'Morning Check-in',
                'morning-6': 'Morning Check-in',
                'midday-1': 'Midday Reset',
                'midday-2': 'Midday Reset',
                'midday-3': 'Midday Reset',
                'evening-1': 'Evening Reflection',
                'evening-2': 'Evening Reflection',
                'evening-3': 'Evening Reflection',
                'evening-4': 'Evening Reflection',
                'crisis-plan': 'Crisis Prevention',
                'onboarding-1': 'Welcome',
                'onboarding-2': 'Assessment',
                'onboarding-3': 'Assessment',
                'onboarding-4': 'Your Values',
                'onboarding-5': 'Notifications',
                'onboarding-6': 'Privacy',
                'onboarding-7': 'Welcome',
                'assessments-menu': 'Assessments',
                'assessment-phq9': 'PHQ-9 Assessment',
                'assessment-gad7': 'GAD-7 Assessment',
                'assessment-results': 'Assessment Results'
            };
            titleElement.textContent = titles[screenId] || 'FullMind';
        }
        
        // Skip onboarding function
        function skipOnboarding() {
            const currentScreen = screenHistory[screenHistory.length - 1];
            // Skip to next major section based on current screen
            if (currentScreen === 'onboarding-2' || currentScreen === 'onboarding-3') {
                showScreen('onboarding-4'); // Skip to values
            } else if (currentScreen === 'onboarding-4') {
                showScreen('onboarding-5'); // Skip to notifications
            } else if (currentScreen === 'onboarding-5') {
                showScreen('onboarding-6'); // Skip to privacy (required)
            }
        }
        
        // Set Active Navigation Item
        function setActiveNav(element) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
        }
        
        // Body Part Selection
        function toggleBodyPart(element) {
            element.classList.toggle('selected');
        }
        
        // Multi-Select Options
        function toggleSelection(element) {
            element.classList.toggle('selected');
        }
        
        // Single Select (Radio-like)
        function selectSingle(element) {
            element.parentElement.querySelectorAll('.select-option').forEach(option => {
                option.classList.remove('selected');
            });
            element.classList.add('selected');
        }
        
        // Thought Acknowledgment
        function acknowledgeThought(element) {
            element.classList.add('acknowledged');
            setTimeout(() => {
                element.style.opacity = '0.3';
            }, 500);
        }
        
        // Enhanced Slider Value Update
        function updateSliderValue(slider) {
            const container = slider.closest('.slider-container');
            const valueDisplay = container.querySelector('.slider-value');
            const fill = container.querySelector('.slider-fill');
            
            if (valueDisplay) {
                valueDisplay.textContent = slider.value;
            }
            
            if (fill) {
                const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
                fill.style.width = percentage + '%';
            }
        }
        
        // Complete Check-in Function
        function completeCheckIn(type) {
            // Could add completion animation or tracking here
            let message = '';
            if (type === 'morning') {
                message = '🌅 Morning check-in complete! You\'ve started your day with awareness.';
            } else if (type === 'midday') {
                message = '🌊 Midday reset complete! You\'ve reconnected with the present.';
            } else if (type === 'evening') {
                message = '🌙 Evening reflection complete! Rest well.';
            }
            
            // Show brief confirmation (optional)
            // alert(message);
            
            // Return to home
            showScreen('home');
        }
        
        // Crisis Plan Save
        function saveCrisisPlan() {
            alert('Crisis plan saved successfully! You can access it anytime from the SOS button.');
            showScreen('home');
        }
        
        // Toggle collapsible sections in Profile
        function toggleSection(section) {
            const valuesContent = document.getElementById('values-content');
            const progressContent = document.getElementById('progress-content');
            const settingsContent = document.getElementById('settings-content');
            const valuesArrow = document.getElementById('values-arrow');
            const progressArrow = document.getElementById('progress-arrow');
            const settingsArrow = document.getElementById('settings-arrow');
            
            if (section === 'values') {
                // Toggle values section
                if (valuesContent.classList.contains('open')) {
                    // If values is open and clicked, just close it
                    valuesContent.classList.remove('open');
                    valuesArrow.classList.remove('open');
                } else {
                    // Open values, close others
                    valuesContent.classList.add('open');
                    valuesArrow.classList.add('open');
                    progressContent.classList.remove('open');
                    progressArrow.classList.remove('open');
                    settingsContent.classList.remove('open');
                    settingsArrow.classList.remove('open');
                }
            } else if (section === 'progress') {
                // Toggle progress section
                if (progressContent.classList.contains('open')) {
                    // If progress is open and clicked, just close it
                    progressContent.classList.remove('open');
                    progressArrow.classList.remove('open');
                } else {
                    // Open progress, close others
                    progressContent.classList.add('open');
                    progressArrow.classList.add('open');
                    valuesContent.classList.remove('open');
                    valuesArrow.classList.remove('open');
                    settingsContent.classList.remove('open');
                    settingsArrow.classList.remove('open');
                }
            } else if (section === 'settings') {
                // Toggle settings section
                if (settingsContent.classList.contains('open')) {
                    // If settings is open and clicked, just close it
                    settingsContent.classList.remove('open');
                    settingsArrow.classList.remove('open');
                } else {
                    // Open settings, close others
                    settingsContent.classList.add('open');
                    settingsArrow.classList.add('open');
                    valuesContent.classList.remove('open');
                    valuesArrow.classList.remove('open');
                    progressContent.classList.remove('open');
                    progressArrow.classList.remove('open');
                }
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial screen
            showScreen('home');
        });
        
        // Values Selection for Onboarding
        let selectedValues = [];
        function toggleValueSelection(element) {
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                selectedValues = selectedValues.filter(v => v !== element.textContent);
            } else {
                if (selectedValues.length < 5) {
                    element.classList.add('selected');
                    selectedValues.push(element.textContent);
                }
            }
            
            // Update counter
            const counter = document.getElementById('values-counter');
            if (counter) {
                counter.textContent = `Selected: ${selectedValues.length}/5`;
            }
            
            // Enable/disable continue button
            const continueBtn = document.getElementById('values-continue-btn');
            if (continueBtn) {
                if (selectedValues.length >= 3 && selectedValues.length <= 5) {
                    continueBtn.disabled = false;
                    continueBtn.style.background = 'var(--info)';
                    continueBtn.style.color = 'white';
                    continueBtn.style.cursor = 'pointer';
                    continueBtn.textContent = 'Continue';
                } else {
                    continueBtn.disabled = true;
                    continueBtn.style.background = 'var(--gray-300)';
                    continueBtn.style.color = 'var(--gray-600)';
                    continueBtn.style.cursor = 'not-allowed';
                    continueBtn.textContent = 'Continue (Select 3-5 values)';
                }
            }
        }
        
        // Privacy Consent Toggle
        function togglePrivacyConsent() {
            const checkbox = document.getElementById('privacy-consent');
            const continueBtn = document.getElementById('privacy-continue-btn');
            
            if (checkbox && continueBtn) {
                if (checkbox.checked) {
                    continueBtn.disabled = false;
                    continueBtn.style.background = 'var(--info)';
                    continueBtn.style.color = 'white';
                    continueBtn.style.cursor = 'pointer';
                } else {
                    continueBtn.disabled = true;
                    continueBtn.style.background = 'var(--gray-300)';
                    continueBtn.style.color = 'var(--gray-600)';
                    continueBtn.style.cursor = 'not-allowed';
                }
            }
        }
    </script>
</body>
</html>