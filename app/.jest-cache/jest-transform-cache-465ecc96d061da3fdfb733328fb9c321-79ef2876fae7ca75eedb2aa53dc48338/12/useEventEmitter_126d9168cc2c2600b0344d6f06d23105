d08fffdccc8d4c8a174076b9eb704c4d
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useEventEmitter = useEventEmitter;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var React = _interopRequireWildcard(require("react"));
function useEventEmitter(listen) {
  var listenRef = React.useRef(listen);
  React.useEffect(function () {
    listenRef.current = listen;
  });
  var listeners = React.useRef(Object.create(null));
  var create = React.useCallback(function (target) {
    var removeListener = function removeListener(type, callback) {
      var callbacks = listeners.current[type] ? listeners.current[type][target] : undefined;
      if (!callbacks) {
        return;
      }
      var index = callbacks.indexOf(callback);
      if (index > -1) {
        callbacks.splice(index, 1);
      }
    };
    var addListener = function addListener(type, callback) {
      listeners.current[type] = listeners.current[type] || {};
      listeners.current[type][target] = listeners.current[type][target] || [];
      listeners.current[type][target].push(callback);
      var removed = false;
      return function () {
        if (!removed) {
          removed = true;
          removeListener(type, callback);
        }
      };
    };
    return {
      addListener: addListener,
      removeListener: removeListener
    };
  }, []);
  var emit = React.useCallback(function (_ref) {
    var _items$target, _ref2;
    var type = _ref.type,
      data = _ref.data,
      target = _ref.target,
      canPreventDefault = _ref.canPreventDefault;
    var items = listeners.current[type] || {};
    var callbacks = target !== undefined ? (_items$target = items[target]) == null ? void 0 : _items$target.slice() : (_ref2 = []).concat.apply(_ref2, (0, _toConsumableArray2.default)(Object.keys(items).map(function (t) {
      return items[t];
    }))).filter(function (cb, i, self) {
      return self.lastIndexOf(cb) === i;
    });
    var event = {
      get type() {
        return type;
      }
    };
    if (target !== undefined) {
      Object.defineProperty(event, 'target', {
        enumerable: true,
        get: function get() {
          return target;
        }
      });
    }
    if (data !== undefined) {
      Object.defineProperty(event, 'data', {
        enumerable: true,
        get: function get() {
          return data;
        }
      });
    }
    if (canPreventDefault) {
      var defaultPrevented = false;
      Object.defineProperties(event, {
        defaultPrevented: {
          enumerable: true,
          get: function get() {
            return defaultPrevented;
          }
        },
        preventDefault: {
          enumerable: true,
          value: function value() {
            defaultPrevented = true;
          }
        }
      });
    }
    listenRef.current == null || listenRef.current(event);
    callbacks == null || callbacks.forEach(function (cb) {
      return cb(event);
    });
    return event;
  }, []);
  return React.useMemo(function () {
    return {
      create: create,
      emit: emit
    };
  }, [create, emit]);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWFjdCIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwicmVxdWlyZSIsInVzZUV2ZW50RW1pdHRlciIsImxpc3RlbiIsImxpc3RlblJlZiIsInVzZVJlZiIsInVzZUVmZmVjdCIsImN1cnJlbnQiLCJsaXN0ZW5lcnMiLCJPYmplY3QiLCJjcmVhdGUiLCJ1c2VDYWxsYmFjayIsInRhcmdldCIsInJlbW92ZUxpc3RlbmVyIiwidHlwZSIsImNhbGxiYWNrIiwiY2FsbGJhY2tzIiwidW5kZWZpbmVkIiwiaW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIiwiYWRkTGlzdGVuZXIiLCJwdXNoIiwicmVtb3ZlZCIsImVtaXQiLCJfcmVmIiwiX2l0ZW1zJHRhcmdldCIsIl9yZWYyIiwiZGF0YSIsImNhblByZXZlbnREZWZhdWx0IiwiaXRlbXMiLCJzbGljZSIsImNvbmNhdCIsImFwcGx5IiwiX3RvQ29uc3VtYWJsZUFycmF5MiIsImRlZmF1bHQiLCJrZXlzIiwibWFwIiwidCIsImZpbHRlciIsImNiIiwiaSIsInNlbGYiLCJsYXN0SW5kZXhPZiIsImV2ZW50IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiZGVmYXVsdFByZXZlbnRlZCIsImRlZmluZVByb3BlcnRpZXMiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwiZm9yRWFjaCIsInVzZU1lbW8iXSwic291cmNlcyI6WyIuLi8uLi9zcmMvdXNlRXZlbnRFbWl0dGVyLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6W251bGxdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsSUFBQUEsS0FBQSxHQUFBQyx1QkFBQSxDQUFBQyxPQUFBO0FBY08sU0FBU0MsZUFBZUEsQ0FDN0JDLE1BQXlCLEVBQ0U7RUFDM0IsSUFBTUMsU0FBUyxHQUFHTCxLQUFLLENBQUNNLE1BQU0sQ0FBQ0YsTUFBTSxDQUFDO0VBRXRDSixLQUFLLENBQUNPLFNBQVMsQ0FBQyxZQUFNO0lBQ3BCRixTQUFTLENBQUNHLE9BQU8sR0FBR0os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