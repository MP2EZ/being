{"version":3,"names":["_assessmentStore","require","describe","beforeEach","useAssessmentStore","getState","resetAssessment","it","_asyncToGenerator2","default","_updatedStore$current","_updatedStore$current2","_updatedStore$current3","_updatedStore$current4","_updatedStore$current5","store","expect","currentSession","toBeNull","startAssessment","Promise","resolve","setTimeout","updatedStore","toBeTruthy","type","toBe","context","id","toBeDefined","console","log","_updatedStore$current6","answerQuestion","answers","toHaveLength","questionId","response","_updatedStore$crisisD","mockAlert","jest","fn","mockLinking","mockRN","Alert","alert","Linking","openURL","crisisDetection","triggerType","crisisIntervention","mock","calls","length"],"sources":["assessmentStore.basic.test.ts"],"sourcesContent":["/**\n * Basic Assessment Store Session Creation Test\n * CRITICAL CLINICAL SAFETY VALIDATION\n *\n * This test validates that the reported \"currentSession = null\" issue\n * is actually resolved and startAssessment() works correctly.\n */\n\nimport { useAssessmentStore } from '../assessmentStore';\n\ndescribe('Assessment Store - Basic Session Creation', () => {\n  beforeEach(() => {\n    useAssessmentStore.getState().resetAssessment();\n  });\n\n  it('CRITICAL: startAssessment creates currentSession correctly', async () => {\n    const store = useAssessmentStore.getState();\n\n    // Verify initial state\n    expect(store.currentSession).toBeNull();\n\n    // Start PHQ-9 assessment and wait for completion\n    await store.startAssessment('phq9', 'clinical_validation');\n\n    // ASYNC TIMING PATTERN: 10ms wait for state synchronization\n    // PURPOSE: Zustand store updates are async and may not complete immediately\n    // REASON: startAssessment() triggers async operations that update store state\n    // TIMING: 10ms provides sufficient time for state updates without slowing tests\n    await new Promise(resolve => setTimeout(resolve, 10));\n\n    // CRITICAL SAFETY CHECK: currentSession must NOT be null\n    const updatedStore = useAssessmentStore.getState();\n    expect(updatedStore.currentSession).toBeTruthy();\n    expect(updatedStore.currentSession?.type).toBe('phq9');\n    expect(updatedStore.currentSession?.context).toBe('clinical_validation');\n    expect(updatedStore.currentSession?.id).toBeDefined();\n\n    console.log('âœ… CLINICAL SAFETY VERIFIED: currentSession created successfully');\n    console.log('Session ID:', updatedStore.currentSession?.id);\n    console.log('Session Type:', updatedStore.currentSession?.type);\n  });\n\n  it('CRITICAL: startAssessment works for GAD-7', async () => {\n    const store = useAssessmentStore.getState();\n\n    await store.startAssessment('gad7', 'clinical_validation');\n\n    // ASYNC TIMING: State synchronization wait (same pattern as above)\n    await new Promise(resolve => setTimeout(resolve, 10));\n\n    const updatedStore = useAssessmentStore.getState();\n    expect(updatedStore.currentSession).toBeTruthy();\n    expect(updatedStore.currentSession?.type).toBe('gad7');\n\n    console.log('âœ… GAD-7 SESSION CREATED: Crisis detection pathway enabled');\n  });\n\n  it('CRITICAL: Can answer questions after session creation', async () => {\n    const store = useAssessmentStore.getState();\n\n    await store.startAssessment('phq9');\n    // ASYNC TIMING: Session creation wait\n    await new Promise(resolve => setTimeout(resolve, 10));\n\n    await store.answerQuestion('phq9_1', 2);\n    // ASYNC TIMING: Answer processing wait\n    await new Promise(resolve => setTimeout(resolve, 10));\n\n    const updatedStore = useAssessmentStore.getState();\n    expect(updatedStore.answers).toHaveLength(1);\n    expect(updatedStore.answers[0].questionId).toBe('phq9_1');\n    expect(updatedStore.answers[0].response).toBe(2);\n\n    console.log('âœ… THERAPEUTIC FLOW VERIFIED: Assessment answers recorded');\n  });\n\n  it('CRITICAL: Suicidal ideation detection triggers immediately', async () => {\n    // Mock Alert and Linking before using them\n    const mockAlert = jest.fn();\n    const mockLinking = jest.fn(() => Promise.resolve());\n\n    // Mock react-native Alert and Linking\n    const mockRN = require('react-native');\n    mockRN.Alert.alert = mockAlert;\n    mockRN.Linking.openURL = mockLinking;\n\n    const store = useAssessmentStore.getState();\n\n    await store.startAssessment('phq9');\n    // ASYNC TIMING: Session creation wait\n    await new Promise(resolve => setTimeout(resolve, 10));\n\n    await store.answerQuestion('phq9_9', 1); // Suicidal ideation\n    // ASYNC TIMING: Crisis detection processing wait\n    // REASON: Crisis detection triggers multiple async operations (alerts, interventions)\n    // TIMING: 100ms allows sufficient time for crisis workflow completion\n    await new Promise(resolve => setTimeout(resolve, 100));\n\n    const updatedStore = useAssessmentStore.getState();\n    expect(updatedStore.crisisDetection).toBeTruthy();\n    expect(updatedStore.crisisDetection?.triggerType).toBe('phq9_suicidal');\n    expect(updatedStore.crisisIntervention).toBeTruthy();\n\n    console.log('ðŸš¨ CRISIS DETECTION VERIFIED: Suicidal ideation pathway active');\n    console.log('ðŸš¨ CRISIS INTERVENTION STATE:', updatedStore.crisisIntervention);\n\n    console.log('Alert.alert called:', mockAlert.mock.calls.length, 'times');\n    if (mockAlert.mock.calls.length > 0) {\n      console.log('Alert call details:', mockAlert.mock.calls[0]);\n    }\n  });\n});"],"mappings":"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","ignoreList":[]}