{"version":3,"names":["isCrisisAction","action","type","includes","requiresCrisisValidation","ASSESSMENT_STORE_CONFIG","exports","MAX_RECENT_RESULTS","SESSION_TIMEOUT_MS","CRISIS_INTERVENTION_TIMEOUT_MS","PERFORMANCE_RETENTION_MS","AUTO_SAVE_INTERVAL_MS"],"sources":["actions.ts"],"sourcesContent":["/**\n * Assessment Store Action Types - Comprehensive Type Safety\n * Zustand store actions with strict typing and crisis safety constraints\n * Supports PHQ≥20, GAD≥15 automatic crisis intervention\n */\n\nimport { \n  AssessmentType, \n  AssessmentResponse, \n  AssessmentSession,\n  AssessmentProgress,\n  PHQ9Result,\n  GAD7Result,\n  CrisisDetection,\n  CrisisIntervention,\n  AssessmentAnswer\n} from '../index';\n\n/**\n * Base Action Interface\n * All store actions must extend this for consistency\n */\nexport interface BaseAssessmentAction {\n  /** Timestamp when action was dispatched */\n  timestamp: number;\n  /** Session ID for action tracking */\n  sessionId: string;\n  /** User ID (encrypted) */\n  userId?: string;\n}\n\n/**\n * Assessment Lifecycle Actions\n */\n\nexport interface StartAssessmentAction extends BaseAssessmentAction {\n  type: 'START_ASSESSMENT';\n  payload: {\n    assessmentType: AssessmentType;\n    context: 'standalone' | 'onboarding' | 'checkin';\n    /** Optional session ID override */\n    customSessionId?: string;\n    /** Whether to continue previous incomplete session */\n    continueSession?: boolean;\n  };\n}\n\nexport interface AnswerQuestionAction extends BaseAssessmentAction {\n  type: 'ANSWER_QUESTION';\n  payload: {\n    questionId: string;\n    response: AssessmentResponse;\n    /** Whether this answer changed from previous */\n    isChange?: boolean;\n    /** Response time in milliseconds */\n    responseTimeMs: number;\n  };\n}\n\nexport interface NavigateQuestionAction extends BaseAssessmentAction {\n  type: 'NAVIGATE_QUESTION';\n  payload: {\n    direction: 'next' | 'previous' | 'jump';\n    targetIndex: number;\n    /** Current index before navigation */\n    fromIndex: number;\n  };\n}\n\nexport interface CompleteAssessmentAction extends BaseAssessmentAction {\n  type: 'COMPLETE_ASSESSMENT';\n  payload: {\n    result: PHQ9Result | GAD7Result;\n    /** Total time taken for assessment (ms) */\n    totalTimeMs: number;\n    /** Whether assessment was completed normally vs interrupted */\n    completionType: 'normal' | 'interrupted' | 'crisis_triggered';\n  };\n}\n\nexport interface ResetAssessmentAction extends BaseAssessmentAction {\n  type: 'RESET_ASSESSMENT';\n  payload: {\n    /** Whether to preserve answers for retry */\n    preserveAnswers?: boolean;\n    /** Reason for reset */\n    reason: 'user_initiated' | 'error' | 'timeout' | 'crisis_intervention';\n  };\n}\n\n/**\n * Crisis Intervention Actions - CRITICAL SAFETY\n */\n\nexport interface TriggerCrisisInterventionAction extends BaseAssessmentAction {\n  type: 'TRIGGER_CRISIS_INTERVENTION';\n  payload: {\n    detection: CrisisDetection;\n    /** REQUIRED: Must be <200ms from trigger */\n    responseTimeMs: number;\n    /** Auto-trigger vs manual trigger */\n    triggerSource: 'auto_phq9_score' | 'auto_gad7_score' | 'auto_phq9_suicidal' | 'manual_override';\n    /** Assessment state when crisis was triggered */\n    assessmentSnapshot: AssessmentProgress;\n  };\n}\n\nexport interface UpdateCrisisInterventionAction extends BaseAssessmentAction {\n  type: 'UPDATE_CRISIS_INTERVENTION';\n  payload: {\n    interventionId: string;\n    updates: Partial<CrisisIntervention>;\n    /** What was updated */\n    updateType: 'contact_support' | 'acknowledge_resources' | 'safety_plan_reviewed' | 'dismissed_safely';\n  };\n}\n\nexport interface ResolveCrisisInterventionAction extends BaseAssessmentAction {\n  type: 'RESOLVE_CRISIS_INTERVENTION';\n  payload: {\n    interventionId: string;\n    resolution: 'support_contacted' | 'safety_plan_completed' | 'professional_referral' | 'user_safe';\n    /** Total intervention duration (ms) */\n    interventionDurationMs: number;\n    /** Follow-up required */\n    requiresFollowUp: boolean;\n  };\n}\n\n/**\n * Session Management Actions\n */\n\nexport interface SaveSessionAction extends BaseAssessmentAction {\n  type: 'SAVE_SESSION';\n  payload: {\n    session: AssessmentSession;\n    /** Whether to encrypt sensitive data */\n    encrypt: boolean;\n    /** Storage location preference */\n    storageLocation: 'local' | 'secure' | 'both';\n  };\n}\n\nexport interface LoadSessionAction extends BaseAssessmentAction {\n  type: 'LOAD_SESSION';\n  payload: {\n    sessionId: string;\n    /** Whether session was successfully loaded */\n    success: boolean;\n    session?: AssessmentSession;\n    /** Error if load failed */\n    error?: string;\n  };\n}\n\nexport interface DeleteSessionAction extends BaseAssessmentAction {\n  type: 'DELETE_SESSION';\n  payload: {\n    sessionId: string;\n    /** Reason for deletion */\n    reason: 'user_requested' | 'expired' | 'data_cleanup' | 'privacy_request';\n    /** Whether deletion was successful */\n    success: boolean;\n  };\n}\n\n/**\n * Analytics and Monitoring Actions\n */\n\nexport interface TrackAssessmentEventAction extends BaseAssessmentAction {\n  type: 'TRACK_ASSESSMENT_EVENT';\n  payload: {\n    eventType: 'question_viewed' | 'answer_selected' | 'progress_updated' | 'assessment_paused' | 'assessment_resumed';\n    eventData: Record<string, unknown>;\n    /** Whether event contains sensitive data */\n    containsSensitiveData: boolean;\n  };\n}\n\nexport interface RecordPerformanceMetricAction extends BaseAssessmentAction {\n  type: 'RECORD_PERFORMANCE_METRIC';\n  payload: {\n    metricType: 'render_time' | 'response_time' | 'navigation_time' | 'crisis_response_time';\n    value: number;\n    unit: 'ms' | 'fps' | 'bytes';\n    /** Performance threshold violation */\n    isViolation?: boolean;\n  };\n}\n\n/**\n * Error Handling Actions\n */\n\nexport interface HandleAssessmentErrorAction extends BaseAssessmentAction {\n  type: 'HANDLE_ASSESSMENT_ERROR';\n  payload: {\n    error: Error;\n    errorType: 'validation' | 'storage' | 'calculation' | 'navigation' | 'crisis_system';\n    /** Whether error is recoverable */\n    isRecoverable: boolean;\n    /** Recovery strategy */\n    recoveryStrategy?: 'retry' | 'reset' | 'fallback' | 'escalate';\n    /** Whether error affects crisis safety */\n    affectsCrisisSafety: boolean;\n  };\n}\n\n/**\n * Union of All Assessment Actions\n */\nexport type AssessmentAction = \n  | StartAssessmentAction\n  | AnswerQuestionAction\n  | NavigateQuestionAction\n  | CompleteAssessmentAction\n  | ResetAssessmentAction\n  | TriggerCrisisInterventionAction\n  | UpdateCrisisInterventionAction\n  | ResolveCrisisInterventionAction\n  | SaveSessionAction\n  | LoadSessionAction\n  | DeleteSessionAction\n  | TrackAssessmentEventAction\n  | RecordPerformanceMetricAction\n  | HandleAssessmentErrorAction;\n\n/**\n * Store State Shape\n */\nexport interface AssessmentStoreState {\n  /** Current active session */\n  currentSession: AssessmentSession | null;\n  /** Active crisis intervention */\n  activeCrisisIntervention: CrisisIntervention | null;\n  /** Recent assessment results (encrypted) */\n  recentResults: Array<PHQ9Result | GAD7Result>;\n  /** Performance metrics */\n  performanceMetrics: {\n    averageResponseTime: number;\n    crisisResponseTimes: number[];\n    renderPerformance: number[];\n  };\n  /** Error state */\n  error: {\n    hasError: boolean;\n    errorMessage?: string;\n    errorType?: string;\n    isRecoverable?: boolean;\n  };\n  /** Loading states */\n  loading: {\n    startingAssessment: boolean;\n    savingProgress: boolean;\n    calculatingResults: boolean;\n    triggeringCrisis: boolean;\n  };\n}\n\n/**\n * Store Actions Interface\n */\nexport interface AssessmentStoreActions {\n  // Assessment Lifecycle\n  startAssessment: (type: AssessmentType, context?: string) => Promise<void>;\n  answerQuestion: (questionId: string, response: AssessmentResponse) => Promise<void>;\n  navigateToQuestion: (index: number) => void;\n  completeAssessment: () => Promise<PHQ9Result | GAD7Result>;\n  resetAssessment: (preserveAnswers?: boolean) => void;\n  \n  // Crisis Intervention - CRITICAL SAFETY\n  triggerCrisisIntervention: (detection: CrisisDetection) => Promise<void>;\n  updateCrisisIntervention: (updates: Partial<CrisisIntervention>) => void;\n  resolveCrisisIntervention: (resolution: string) => Promise<void>;\n  \n  // Session Management\n  saveSession: (encrypt?: boolean) => Promise<void>;\n  loadSession: (sessionId: string) => Promise<AssessmentSession | null>;\n  deleteSession: (sessionId: string) => Promise<boolean>;\n  \n  // Utilities\n  validateAssessmentData: () => boolean;\n  calculateScore: (answers: AssessmentAnswer[], type: AssessmentType) => number;\n  checkCrisisThresholds: (score: number, type: AssessmentType, answers?: AssessmentAnswer[]) => CrisisDetection | null;\n  \n  // Performance Monitoring\n  recordPerformanceMetric: (type: string, value: number) => void;\n  getPerformanceReport: () => Record<string, number>;\n  \n  // Error Handling\n  handleError: (error: Error, context: string) => void;\n  clearError: () => void;\n  recoverFromError: () => Promise<boolean>;\n}\n\n/**\n * Action Creator Type Helpers\n */\nexport type AssessmentActionCreator<T extends AssessmentAction> = (\n  payload: T['payload']\n) => T;\n\nexport type AssessmentThunkAction<T = void> = (\n  get: () => AssessmentStoreState,\n  set: (partial: Partial<AssessmentStoreState>) => void\n) => Promise<T> | T;\n\n/**\n * Crisis Safety Type Guards\n */\nexport function isCrisisAction(action: AssessmentAction): action is TriggerCrisisInterventionAction | UpdateCrisisInterventionAction | ResolveCrisisInterventionAction {\n  return action.type.includes('CRISIS');\n}\n\nexport function requiresCrisisValidation(action: AssessmentAction): boolean {\n  return action.type === 'COMPLETE_ASSESSMENT' || \n         action.type === 'ANSWER_QUESTION' ||\n         action.type === 'TRIGGER_CRISIS_INTERVENTION';\n}\n\n/**\n * Store Configuration Constants\n */\nexport const ASSESSMENT_STORE_CONFIG = {\n  /** Maximum number of recent results to store */\n  MAX_RECENT_RESULTS: 50,\n  /** Session timeout in milliseconds */\n  SESSION_TIMEOUT_MS: 30 * 60 * 1000, // 30 minutes\n  /** Crisis intervention timeout (must respond within) */\n  CRISIS_INTERVENTION_TIMEOUT_MS: 5 * 60 * 1000, // 5 minutes\n  /** Performance metric retention period */\n  PERFORMANCE_RETENTION_MS: 7 * 24 * 60 * 60 * 1000, // 7 days\n  /** Auto-save interval */\n  AUTO_SAVE_INTERVAL_MS: 10 * 1000, // 10 seconds\n} as const;"],"mappings":";;;;;;AAwTO,SAASA,cAAcA,CAACC,MAAwB,EAAgH;EACrK,OAAOA,MAAM,CAACC,IAAI,CAACC,QAAQ,CAAC,QAAQ,CAAC;AACvC;AAEO,SAASC,wBAAwBA,CAACH,MAAwB,EAAW;EAC1E,OAAOA,MAAM,CAACC,IAAI,KAAK,qBAAqB,IACrCD,MAAM,CAACC,IAAI,KAAK,iBAAiB,IACjCD,MAAM,CAACC,IAAI,KAAK,6BAA6B;AACtD;AAKO,IAAMG,uBAAuB,GAAAC,OAAA,CAAAD,uBAAA,GAAG;EAErCE,kBAAkB,EAAE,EAAE;EAEtBC,kBAAkB,EAAE,EAAE,GAAG,EAAE,GAAG,IAAI;EAElCC,8BAA8B,EAAE,CAAC,GAAG,EAAE,GAAG,IAAI;EAE7CC,wBAAwB,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI;EAEjDC,qBAAqB,EAAE,EAAE,GAAG;AAC9B,CAAU","ignoreList":[]}