{"version":3,"names":["_StyleSheet","_interopRequireDefault","require","_VirtualViewNativeComponent","_nullthrows","_react","_interopRequireWildcard","React","_jsxRuntime","NotHidden","createVirtualView","initialState","initialHidden","VirtualView","forwardRef","VirtualView_withRef","_ref","ref","children","nativeID","style","onModeChange","_useState","useState","_useState2","_slicedToArray2","default","state","setState","__DEV__","_logs$states","_logs","states","push","isHidden","handleModeChange","event","mode","nullthrows","VirtualViewMode","cast","nativeEvent","emitModeChange","bind","target","currentTarget","targetRect","thresholdRect","$$gen$m0","Visible","Prerender","startTransition","Hidden","height","Error","jsx","renderState","VirtualViewRenderState","None","Rendered","StyleSheet","compose","Math","abs","_default","exports","createHiddenVirtualView"],"sources":["VirtualView.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport type {ViewStyleProp} from '../../../../Libraries/StyleSheet/StyleSheet';\nimport type {NativeSyntheticEvent} from '../../../../Libraries/Types/CoreEventTypes';\nimport type ReadOnlyElement from '../../webapis/dom/nodes/ReadOnlyElement';\nimport type {NativeModeChangeEvent} from './VirtualViewNativeComponent';\n\nimport StyleSheet from '../../../../Libraries/StyleSheet/StyleSheet';\nimport VirtualViewNativeComponent from './VirtualViewNativeComponent';\nimport nullthrows from 'nullthrows';\nimport * as React from 'react';\nimport {startTransition, useState} from 'react';\n\n// @see VirtualViewNativeComponent\nexport enum VirtualViewMode {\n  Visible = 0,\n  Prerender = 1,\n  Hidden = 2,\n}\n\n// @see VirtualViewNativeComponent\nexport enum VirtualViewRenderState {\n  Unknown = 0,\n  Rendered = 1,\n  None = 2,\n}\n\nexport type Rect = $ReadOnly<{\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n}>;\n\nexport type ModeChangeEvent = $ReadOnly<{\n  ...Omit<NativeModeChangeEvent, 'mode'>,\n  mode: VirtualViewMode,\n  target: ReadOnlyElement,\n}>;\n\ntype VirtualViewComponent = component(\n  children?: React.Node,\n  nativeID?: string,\n  ref?: ?React.RefSetter<React.ElementRef<typeof VirtualViewNativeComponent>>,\n  style?: ?ViewStyleProp,\n  onModeChange?: (event: ModeChangeEvent) => void,\n);\n\ntype HiddenHeight = number;\nconst NotHidden = null;\n\ntype State = HiddenHeight | typeof NotHidden;\n\nfunction createVirtualView(initialState: State): VirtualViewComponent {\n  const initialHidden = initialState !== NotHidden;\n\n  component VirtualView(\n    children?: React.Node,\n    nativeID?: string,\n    ref?: ?React.RefSetter<React.ElementRef<typeof VirtualViewNativeComponent>>,\n    style?: ?ViewStyleProp,\n    onModeChange?: (event: ModeChangeEvent) => void,\n  ) {\n    const [state, setState] = useState<State>(initialState);\n    if (__DEV__) {\n      _logs.states?.push(state);\n    }\n    const isHidden = state !== NotHidden;\n\n    const handleModeChange = (\n      event: NativeSyntheticEvent<NativeModeChangeEvent>,\n    ) => {\n      const mode = nullthrows(VirtualViewMode.cast(event.nativeEvent.mode));\n      const emitModeChange =\n        onModeChange == null\n          ? null\n          : onModeChange.bind(null, {\n              mode,\n              // $FlowIgnore[incompatible-cast]\n              target: event.currentTarget as ReadOnlyElement,\n              targetRect: event.nativeEvent.targetRect,\n              thresholdRect: event.nativeEvent.thresholdRect,\n            });\n\n      match (mode) {\n        VirtualViewMode.Visible => {\n          setState(NotHidden);\n          emitModeChange?.();\n        }\n        VirtualViewMode.Prerender => {\n          startTransition(() => {\n            setState(NotHidden);\n            emitModeChange?.();\n          });\n        }\n        VirtualViewMode.Hidden => {\n          const {height} = event.nativeEvent.targetRect;\n          startTransition(() => {\n            setState(height as HiddenHeight);\n            emitModeChange?.();\n          });\n        }\n      }\n    };\n\n    return (\n      <VirtualViewNativeComponent\n        initialHidden={initialHidden}\n        nativeID={nativeID}\n        ref={ref}\n        renderState={\n          (isHidden\n            ? VirtualViewRenderState.None\n            : VirtualViewRenderState.Rendered) as number\n        }\n        style={\n          isHidden\n            ? StyleSheet.compose(style, {\n                height: Math.abs(nullthrows(state) as HiddenHeight),\n              })\n            : style\n        }\n        onModeChange={handleModeChange}>\n        {isHidden ? null : children}\n      </VirtualViewNativeComponent>\n    );\n  }\n  return VirtualView;\n}\n\nexport default createVirtualView(NotHidden) as VirtualViewComponent;\n\nexport function createHiddenVirtualView(height: number): VirtualViewComponent {\n  return createVirtualView(height as HiddenHeight);\n}\n\nexport const _logs: {states?: Array<State>} = {};\n"],"mappings":"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","ignoreList":[]}