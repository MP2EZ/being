4a90cdc66c3d869097202051581ddebc
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useSyncState = useSyncState;
var React = _interopRequireWildcard(require("react"));
var _useLatestCallback = _interopRequireDefault(require("use-latest-callback"));
var _deepFreeze = require("./deepFreeze.js");
var createStore = function createStore(getInitialState) {
  var listeners = [];
  var initialized = false;
  var state;
  var getState = function getState() {
    if (initialized) {
      return state;
    }
    initialized = true;
    state = (0, _deepFreeze.deepFreeze)(getInitialState());
    return state;
  };
  var isBatching = false;
  var didUpdate = false;
  var setState = function setState(newState) {
    state = (0, _deepFreeze.deepFreeze)(newState);
    didUpdate = true;
    if (!isBatching) {
      listeners.forEach(function (listener) {
        return listener();
      });
    }
  };
  var subscribe = function subscribe(callback) {
    listeners.push(callback);
    return function () {
      var index = listeners.indexOf(callback);
      if (index > -1) {
        listeners.splice(index, 1);
      }
    };
  };
  var batchUpdates = function batchUpdates(callback) {
    isBatching = true;
    callback();
    isBatching = false;
    if (didUpdate) {
      didUpdate = false;
      listeners.forEach(function (listener) {
        return listener();
      });
    }
  };
  return {
    getState: getState,
    setState: setState,
    batchUpdates: batchUpdates,
    subscribe: subscribe
  };
};
function useSyncState(getInitialState) {
  var store = React.useRef(createStore(getInitialState)).current;
  var state = React.useSyncExternalStore(store.subscribe, store.getState, store.getState);
  React.useDebugValue(state);
  var pendingUpdatesRef = React.useRef([]);
  var scheduleUpdate = (0, _useLatestCallback.default)(function (callback) {
    pendingUpdatesRef.current.push(callback);
  });
  var flushUpdates = (0, _useLatestCallback.default)(function () {
    var pendingUpdates = pendingUpdatesRef.current;
    pendingUpdatesRef.current = [];
    if (pendingUpdates.length !== 0) {
      store.batchUpdates(function () {
        for (var update of pendingUpdates) {
          update();
        }
      });
    }
  });
  return {
    state: state,
    getState: store.getState,
    setState: store.setState,
    scheduleUpdate: scheduleUpdate,
    flushUpdates: flushUpdates
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWFjdCIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwicmVxdWlyZSIsIl91c2VMYXRlc3RDYWxsYmFjayIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfZGVlcEZyZWV6ZSIsImNyZWF0ZVN0b3JlIiwiZ2V0SW5pdGlhbFN0YXRlIiwibGlzdGVuZXJzIiwiaW5pdGlhbGl6ZWQiLCJzdGF0ZSIsImdldFN0YXRlIiwiZGVlcEZyZWV6ZSIsImlzQmF0Y2hpbmciLCJkaWRVcGRhdGUiLCJzZXRTdGF0ZSIsIm5ld1N0YXRlIiwiZm9yRWFjaCIsImxpc3RlbmVyIiwic3Vic2NyaWJlIiwiY2FsbGJhY2siLCJwdXNoIiwiaW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIiwiYmF0Y2hVcGRhdGVzIiwidXNlU3luY1N0YXRlIiwic3RvcmUiLCJ1c2VSZWYiLCJjdXJyZW50IiwidXNlU3luY0V4dGVybmFsU3RvcmUiLCJ1c2VEZWJ1Z1ZhbHVlIiwicGVuZGluZ1VwZGF0ZXNSZWYiLCJzY2hlZHVsZVVwZGF0ZSIsInVzZUxhdGVzdENhbGxiYWNrIiwiZmx1c2hVcGRhdGVzIiwicGVuZGluZ1VwZGF0ZXMiLCJsZW5ndGgiLCJ1cGRhdGUiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvdXNlU3luY1N0YXRlLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6W251bGxdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxLQUFBLEdBQUFDLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxrQkFBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBRUEsSUFBQUcsV0FBQSxHQUFBSCxPQUFBO0FBRUEsSUFBTUksV0FBVyxHQUFRLFNBQW5CQSxXQUFXQSxDQUFRQyxlQUF3QixFQUFLO0VBQ3BELElBQU1DLFNBQXlCLEdBQUcsRUFBRTtFQUVwQyxJQUFJQyxXQUFXLEdBQUcsS0FBSztFQUN2QixJQUFJQyxLQUFRO0VBRVosSUFBTUMsUUFBUSxHQUFHLFNBQVhBLFFBQVFBLENBQUEsRUFBUztJQUNyQixJQUFJRixXQUFXLEVBQUU7TUFDZixPQUFPQyxLQUFLO0lBQ2Q7SUFFQUQsV0FBVyxHQUFHLElBQUk7SUFDbEJDLEtBQUssR0FBRyxJQUFBRSxzQkFBVSxFQUFDTCxlQUFlLENBQUMsQ0FBQyxDQUFDO0lBRXJDLE9BQU9HLEtBQUs7RUFDZCxDQUFDO0VBRUQsSUFBSUcsVUFBVSxHQUFHLEtBQUs7RUFDdEIsSUFBSUMsU0FBUyxHQUFHLEtBQUs7RUFFckIsSUFBTUMsUUFBUSxHQUFJLFNBQVpBLFFBQVFBLENBQUlDLFFBQVcsRUFBSztJQUNoQ04sS0FBSyxHQUFHLElBQUFFLHNCQUFVLEVBQUNJLFFBQVEsQ0FBQztJQUM1QkYsU0FBUyxHQUFHLElBQUk7SUFFaEIsSUFBSSxDQUFDRCxVQUFVLEVBQUU7TUFDZkwsU0FBUyxDQUFDUyxPQUFPLENBQUUsVUFBQUMsUUFBUTtRQUFBLE9BQUtBLFFBQVEsQ0FBQyxDQUFDO01BQUEsRUFBQztJQUM3QztFQUNGLENBQUM7RUFFRCxJQUFNQyxTQUFTLEdBQUksU0FBYkEsU0FBU0EsQ0FBSUMsUUFBb0IsRUFBSztJQUMxQ1osU0FBUyxDQUFDYSxJQUFJLENBQUNELFFBQVEsQ0FBQztJQUV4QixPQUFPLFlBQU07TUFDWCxJQUFNRSxLQUFLLEdBQUdkLFNBQVMsQ0FBQ2UsT0FBTyxDQUFDSCxRQUFRLENBQUM7TUFFekMsSUFBSUUsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFO1FBQ2RkLFNBQVMsQ0FBQ2dCLE1BQU0sQ0FBQ0YsS0FBSyxFQUFFLENBQUMsQ0FBQztNQUM1QjtJQUNGLENBQUM7RUFDSCxDQUFDO0VBRUQsSUFBTUcsWUFBWSxHQUFJLFNBQWhCQSxZQUFZQSxDQUFJTCxRQUFvQixFQUFLO0lBQzdDUCxVQUFVLEdBQUcsSUFBSTtJQUNqQk8sUUFBUSxDQUFDLENBQUM7SUFDVlAsVUFBVSxHQUFHLEtBQUs7SUFFbEIsSUFBSUMsU0FBUyxFQUFFO01BQ2JBLFNBQVMsR0FBRyxLQUFLO01BQ2pCTixTQUFTLENBQUNTLE9BQU8sQ0FBRSxVQUFBQyxRQUFRO1FBQUEsT0FBS0EsUUFBUSxDQUFDLENBQUM7TUFBQSxFQUFDO0lBQzdDO0VBQ0YsQ0FBQztFQUVELE9BQU87SUFDTFAsUUFBUSxFQUFSQSxRQUFRO0lBQ1JJLFFBQVEsRUFBUkEsUUFBUTtJQUNSVSxZQUFZLEVBQVpBLFlBQVk7SUFDWk4sU0FBQSxFQUFBQTtFQUNGLENBQUM7QUFDSCxDQUFDO0FBRU0sU0FBU08sWUFBWUEsQ0FBSW5CLGVBQXdCLEVBQUU7RUFDeEQsSUFBTW9CLEtBQUssR0FBRzNCLEtBQUssQ0FBQzRCLE1BQU0sQ0FBQ3RCLFdBQVcsQ0FBQ0MsZUFBZSxDQUFDLENBQUMsQ0FBQ3NCLE9BQU87RUFFaEUsSUFBTW5CLEtBQUssR0FBR1YsS0FBSyxDQUFDOEIsb0JBQW9CLENBQ3RDSCxLQUFLLENBQUNSLFNBQVMsRUFDZlEsS0FBSyxDQUFDaEIsUUFBUSxFQUNkZ0IsS0FBSyxDQUFDaEIsUUFDUixDQUFDO0VBRURYLEtBQUssQ0FBQytCLGFBQWEsQ0FBQ3JCLEtBQUssQ0FBQztFQUUxQixJQUFNc0IsaUJBQWlCLEdBQUdoQyxLQUFLLENBQUM0QixNQUFNLENBQWlCLEVBQUUsQ0FBQztFQUUxRCxJQUFNSyxjQUFjLEdBQUcsSUFBQUMsMEJBQWlCLEVBQUUsVUFBQWQsUUFBb0IsRUFBSztJQUNqRVksaUJBQWlCLENBQUNILE9BQU8sQ0FBQ1IsSUFBSSxDQUFDRCxRQUFRLENBQUM7RUFDMUMsQ0FBQyxDQUFDO0VBRUYsSUFBTWUsWUFBWSxHQUFHLElBQUFELDBCQUFpQixFQUFDLFlBQU07SUFDM0MsSUFBTUUsY0FBYyxHQUFHSixpQkFBaUIsQ0FBQ0gsT0FBTztJQUVoREcsaUJBQWlCLENBQUNILE9BQU8sR0FBRyxFQUFFO0lBRTlCLElBQUlPLGNBQWMsQ0FBQ0MsTUFBTSxLQUFLLENBQUMsRUFBRTtNQUMvQlYsS0FBSyxDQUFDRixZQUFZLENBQUMsWUFBTTtRQUV2QixLQUFLLElBQU1hLE1BQU0sSUFBSUYsY0FBYyxFQUFFO1VBQ25DRSxNQUFNLENBQUMsQ0FBQztRQUNWO01BQ0YsQ0FBQyxDQUFDO0lBQ0o7RUFDRixDQUFDLENBQUM7RUFFRixPQUFPO0lBQ0w1QixLQUFLLEVBQUxBLEtBQUs7SUFDTEMsUUFBUSxFQUFFZ0IsS0FBSyxDQUFDaEIsUUFBUTtJQUN4QkksUUFBUSxFQUFFWSxLQUFLLENBQUNaLFFBQVE7SUFDeEJrQixjQUFjLEVBQWRBLGNBQWM7SUFDZEUsWUFBQSxFQUFBQTtFQUNGLENBQUM7QUFDSCIsImlnbm9yZUxpc3QiOltdfQ==