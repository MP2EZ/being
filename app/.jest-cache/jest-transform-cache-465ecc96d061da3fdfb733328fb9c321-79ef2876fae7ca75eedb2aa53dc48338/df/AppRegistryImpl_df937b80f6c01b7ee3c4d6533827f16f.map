{"version":3,"names":["_createPerformanceLogger","_interopRequireDefault","require","_SceneTracker","_DisplayMode","_HeadlessJsTaskError","_NativeHeadlessJsTaskSupport","_renderApplication","_RendererProxy","_invariant","runnables","sections","taskProviders","Map","taskCancelProviders","componentProviderInstrumentationHook","component","wrapperComponentProvider","rootViewStyleProvider","setWrapperComponentProvider","provider","setRootViewStyleProvider","registerConfig","config","forEach","appConfig","run","registerRunnable","appKey","invariant","registerComponent","section","componentProvider","scopedPerformanceLogger","createPerformanceLogger","appParameters","displayMode","renderApplication","initialProps","rootTag","fabric","registerSection","getAppKeys","Object","keys","getSectionKeys","getSections","assign","getRunnable","getRegistry","setComponentProviderInstrumentationHook","hook","runApplication","logParams","__DEV__","JSON","stringify","msg","console","log","SceneTracker","setActiveScene","name","coerceDisplayMode","setSurfaceProps","unmountApplicationComponentAtRootTag","unmountComponentAtNodeAndRemoveContainer","registerHeadlessTask","taskKey","taskProvider","registerCancellableHeadlessTask","taskCancelProvider","has","warn","set","startHeadlessTask","taskId","data","get","NativeHeadlessJsTaskSupport","notifyTaskFinished","then","catch","reason","error","HeadlessJsTaskError","notifyTaskRetry","retryPosted","cancelHeadlessTask","Error"],"sources":["AppRegistryImpl.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n * @format\n */\n\nimport type {RootTag} from '../Types/RootTagTypes';\nimport type {\n  AppConfig,\n  AppParameters,\n  ComponentProvider,\n  ComponentProviderInstrumentationHook,\n  Registry,\n  RootViewStyleProvider,\n  Runnable,\n  Runnables,\n  TaskProvider,\n  WrapperComponentProvider,\n} from './AppRegistry.flow';\n\nimport createPerformanceLogger from '../Utilities/createPerformanceLogger';\nimport SceneTracker from '../Utilities/SceneTracker';\nimport {coerceDisplayMode} from './DisplayMode';\nimport HeadlessJsTaskError from './HeadlessJsTaskError';\nimport NativeHeadlessJsTaskSupport from './NativeHeadlessJsTaskSupport';\nimport renderApplication from './renderApplication';\nimport {unmountComponentAtNodeAndRemoveContainer} from './RendererProxy';\nimport invariant from 'invariant';\n\ntype TaskCanceller = () => void;\ntype TaskCancelProvider = () => TaskCanceller;\n\nconst runnables: Runnables = {};\nconst sections: Runnables = {};\nconst taskProviders: Map<string, TaskProvider> = new Map();\nconst taskCancelProviders: Map<string, TaskCancelProvider> = new Map();\nlet componentProviderInstrumentationHook: ComponentProviderInstrumentationHook =\n  (component: ComponentProvider) => component();\n\nlet wrapperComponentProvider: ?WrapperComponentProvider;\nlet rootViewStyleProvider: ?RootViewStyleProvider;\n\nexport function setWrapperComponentProvider(\n  provider: WrapperComponentProvider,\n) {\n  wrapperComponentProvider = provider;\n}\n\nexport function setRootViewStyleProvider(provider: RootViewStyleProvider) {\n  rootViewStyleProvider = provider;\n}\n\nexport function registerConfig(config: Array<AppConfig>): void {\n  config.forEach(appConfig => {\n    if (appConfig.run) {\n      registerRunnable(appConfig.appKey, appConfig.run);\n    } else {\n      invariant(\n        appConfig.component != null,\n        'AppRegistry.registerConfig(...): Every config is expected to set ' +\n          'either `run` or `component`, but `%s` has neither.',\n        appConfig.appKey,\n      );\n      registerComponent(\n        appConfig.appKey,\n        appConfig.component,\n        appConfig.section,\n      );\n    }\n  });\n}\n\n/**\n * Registers an app's root component.\n *\n * See https://reactnative.dev/docs/appregistry#registercomponent\n */\nexport function registerComponent(\n  appKey: string,\n  componentProvider: ComponentProvider,\n  section?: boolean,\n): string {\n  const scopedPerformanceLogger = createPerformanceLogger();\n  runnables[appKey] = (appParameters, displayMode) => {\n    renderApplication(\n      componentProviderInstrumentationHook(\n        componentProvider,\n        scopedPerformanceLogger,\n      ),\n      appParameters.initialProps,\n      appParameters.rootTag,\n      wrapperComponentProvider && wrapperComponentProvider(appParameters),\n      rootViewStyleProvider && rootViewStyleProvider(appParameters),\n      appParameters.fabric,\n      scopedPerformanceLogger,\n      appKey === 'LogBox', // is logbox\n      appKey,\n      displayMode,\n    );\n  };\n  if (section) {\n    sections[appKey] = runnables[appKey];\n  }\n  return appKey;\n}\n\nexport function registerRunnable(appKey: string, run: Runnable): string {\n  runnables[appKey] = run;\n  return appKey;\n}\n\nexport function registerSection(\n  appKey: string,\n  component: ComponentProvider,\n): void {\n  registerComponent(appKey, component, true);\n}\n\nexport function getAppKeys(): $ReadOnlyArray<string> {\n  return Object.keys(runnables);\n}\n\nexport function getSectionKeys(): $ReadOnlyArray<string> {\n  return Object.keys(sections);\n}\n\nexport function getSections(): Runnables {\n  return {\n    ...sections,\n  };\n}\n\nexport function getRunnable(appKey: string): ?Runnable {\n  return runnables[appKey];\n}\n\nexport function getRegistry(): Registry {\n  return {\n    sections: getSectionKeys(),\n    runnables: {...runnables},\n  };\n}\n\nexport function setComponentProviderInstrumentationHook(\n  hook: ComponentProviderInstrumentationHook,\n) {\n  componentProviderInstrumentationHook = hook;\n}\n\n/**\n * Loads the JavaScript bundle and runs the app.\n *\n * See https://reactnative.dev/docs/appregistry#runapplication\n */\nexport function runApplication(\n  appKey: string,\n  appParameters: AppParameters,\n  displayMode?: number,\n): void {\n  if (appKey !== 'LogBox') {\n    const logParams = __DEV__ ? ` with ${JSON.stringify(appParameters)}` : '';\n    const msg = `Running \"${appKey}\"${logParams}`;\n    console.log(msg);\n  }\n  invariant(\n    runnables[appKey],\n    `\"${appKey}\" has not been registered. This can happen if:\\n` +\n      '* Metro (the local dev server) is run from the wrong folder. ' +\n      'Check if Metro is running, stop it and restart it in the current project.\\n' +\n      \"* A module failed to load due to an error and `AppRegistry.registerComponent` wasn't called.\",\n  );\n\n  SceneTracker.setActiveScene({name: appKey});\n  runnables[appKey](appParameters, coerceDisplayMode(displayMode));\n}\n\n/**\n * Update initial props for a surface that's already rendered\n */\nexport function setSurfaceProps(\n  appKey: string,\n  appParameters: Object,\n  displayMode?: number,\n): void {\n  if (appKey !== 'LogBox') {\n    const msg =\n      'Updating props for Surface \"' +\n      appKey +\n      '\" with ' +\n      JSON.stringify(appParameters);\n    console.log(msg);\n  }\n  invariant(\n    runnables[appKey],\n    `\"${appKey}\" has not been registered. This can happen if:\\n` +\n      '* Metro (the local dev server) is run from the wrong folder. ' +\n      'Check if Metro is running, stop it and restart it in the current project.\\n' +\n      \"* A module failed to load due to an error and `AppRegistry.registerComponent` wasn't called.\",\n  );\n\n  runnables[appKey](appParameters, coerceDisplayMode(displayMode));\n}\n\n/**\n * Stops an application when a view should be destroyed.\n *\n * See https://reactnative.dev/docs/appregistry#unmountapplicationcomponentatroottag\n */\nexport function unmountApplicationComponentAtRootTag(rootTag: RootTag): void {\n  unmountComponentAtNodeAndRemoveContainer(rootTag);\n}\n\n/**\n * Register a headless task. A headless task is a bit of code that runs without a UI.\n *\n * See https://reactnative.dev/docs/appregistry#registerheadlesstask\n */\nexport function registerHeadlessTask(\n  taskKey: string,\n  taskProvider: TaskProvider,\n): void {\n  // $FlowFixMe[object-this-reference]\n  registerCancellableHeadlessTask(taskKey, taskProvider, () => () => {\n    /* Cancel is no-op */\n  });\n}\n\n/**\n * Register a cancellable headless task. A headless task is a bit of code that runs without a UI.\n *\n * See https://reactnative.dev/docs/appregistry#registercancellableheadlesstask\n */\nexport function registerCancellableHeadlessTask(\n  taskKey: string,\n  taskProvider: TaskProvider,\n  taskCancelProvider: TaskCancelProvider,\n): void {\n  if (taskProviders.has(taskKey)) {\n    console.warn(\n      `registerHeadlessTask or registerCancellableHeadlessTask called multiple times for same key '${taskKey}'`,\n    );\n  }\n  taskProviders.set(taskKey, taskProvider);\n  taskCancelProviders.set(taskKey, taskCancelProvider);\n}\n\n/**\n * Only called from native code. Starts a headless task.\n *\n * See https://reactnative.dev/docs/appregistry#startheadlesstask\n */\nexport function startHeadlessTask(\n  taskId: number,\n  taskKey: string,\n  data: any,\n): void {\n  const taskProvider = taskProviders.get(taskKey);\n  if (!taskProvider) {\n    console.warn(`No task registered for key ${taskKey}`);\n    if (NativeHeadlessJsTaskSupport) {\n      NativeHeadlessJsTaskSupport.notifyTaskFinished(taskId);\n    }\n    return;\n  }\n  taskProvider()(data)\n    .then(() => {\n      if (NativeHeadlessJsTaskSupport) {\n        NativeHeadlessJsTaskSupport.notifyTaskFinished(taskId);\n      }\n    })\n    .catch(reason => {\n      console.error(reason);\n\n      if (\n        NativeHeadlessJsTaskSupport &&\n        reason instanceof HeadlessJsTaskError\n      ) {\n        // $FlowFixMe[unused-promise]\n        NativeHeadlessJsTaskSupport.notifyTaskRetry(taskId).then(\n          retryPosted => {\n            if (!retryPosted) {\n              NativeHeadlessJsTaskSupport.notifyTaskFinished(taskId);\n            }\n          },\n        );\n      }\n    });\n}\n\n/**\n * Only called from native code. Cancels a headless task.\n *\n * See https://reactnative.dev/docs/appregistry#cancelheadlesstask\n */\nexport function cancelHeadlessTask(taskId: number, taskKey: string): void {\n  const taskCancelProvider = taskCancelProviders.get(taskKey);\n  if (!taskCancelProvider) {\n    throw new Error(`No task canceller registered for key '${taskKey}'`);\n  }\n  taskCancelProvider()();\n}\n"],"mappings":"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","ignoreList":[]}