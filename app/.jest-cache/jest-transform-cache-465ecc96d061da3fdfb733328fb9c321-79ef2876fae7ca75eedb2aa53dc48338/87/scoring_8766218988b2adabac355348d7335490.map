{"version":3,"names":["isPHQ9ScoringResult","result","isGAD7ScoringResult","isCrisisScore","score","type","isValidAssessmentScore","maxScore","Number","isInteger","PHQ9_SCORING_CONFIG","exports","questionCount","minScore","responseRange","severityThresholds","minimal","mild","moderate","moderately_severe","severe","crisisThreshold","suicidalIdeationQuestionId","GAD7_SCORING_CONFIG"],"sources":["scoring.ts"],"sourcesContent":["/**\n * Assessment Scoring Utility Types - 100% Accuracy Required\n * Comprehensive type definitions for scoring calculations\n * Clinical validation with exact PHQ-9 and GAD-7 algorithms\n * Error handling and validation for therapeutic precision\n */\n\nimport { \n  AssessmentType, \n  AssessmentResponse, \n  AssessmentAnswer, \n  PHQ9Result, \n  GAD7Result \n} from '../index';\nimport { CrisisDetection } from '../crisis/safety';\n\n/**\n * Scoring Algorithm Types\n * Exact clinical implementations for PHQ-9 and GAD-7\n */\n\n/**\n * PHQ-9 Scoring Configuration\n * Based on Kroenke et al. (2001) - Patient Health Questionnaire-9\n */\nexport interface PHQ9ScoringConfig {\n  /** Total number of questions (always 9) */\n  readonly questionCount: 9;\n  /** Minimum possible score */\n  readonly minScore: 0;\n  /** Maximum possible score */\n  readonly maxScore: 27;\n  /** Question response range */\n  readonly responseRange: [0, 1, 2, 3];\n  /** Severity thresholds */\n  readonly severityThresholds: {\n    readonly minimal: [0, 4];\n    readonly mild: [5, 9];\n    readonly moderate: [10, 14];\n    readonly moderately_severe: [15, 19];\n    readonly severe: [20, 27];\n  };\n  /** Crisis detection threshold */\n  readonly crisisThreshold: 20;\n  /** Suicidal ideation question ID */\n  readonly suicidalIdeationQuestionId: 'phq9_9';\n}\n\n/**\n * GAD-7 Scoring Configuration\n * Based on Spitzer et al. (2006) - Generalized Anxiety Disorder 7-item scale\n */\nexport interface GAD7ScoringConfig {\n  /** Total number of questions (always 7) */\n  readonly questionCount: 7;\n  /** Minimum possible score */\n  readonly minScore: 0;\n  /** Maximum possible score */\n  readonly maxScore: 21;\n  /** Question response range */\n  readonly responseRange: [0, 1, 2, 3];\n  /** Severity thresholds */\n  readonly severityThresholds: {\n    readonly minimal: [0, 4];\n    readonly mild: [5, 9];\n    readonly moderate: [10, 14];\n    readonly severe: [15, 21];\n  };\n  /** Crisis detection threshold */\n  readonly crisisThreshold: 15;\n}\n\n/**\n * Scoring Function Signatures\n */\n\n/**\n * PHQ-9 scoring function type\n * Must implement exact clinical algorithm\n */\nexport type PHQ9ScoringFunction = (\n  answers: AssessmentAnswer[]\n) => PHQ9ScoringResult;\n\n/**\n * GAD-7 scoring function type  \n * Must implement exact clinical algorithm\n */\nexport type GAD7ScoringFunction = (\n  answers: AssessmentAnswer[]\n) => GAD7ScoringResult;\n\n/**\n * Generic scoring function type\n */\nexport type AssessmentScoringFunction<T extends AssessmentType> = \n  T extends 'phq9' ? PHQ9ScoringFunction : GAD7ScoringFunction;\n\n/**\n * Scoring Result Types\n */\n\n/**\n * PHQ-9 Scoring Result\n * Complete result with validation and clinical interpretation\n */\nexport interface PHQ9ScoringResult {\n  /** Final calculated score (0-27) */\n  totalScore: number;\n  /** Individual question scores */\n  questionScores: Record<string, AssessmentResponse>;\n  /** Clinical severity interpretation */\n  severity: 'minimal' | 'mild' | 'moderate' | 'moderately_severe' | 'severe';\n  /** Whether score meets crisis threshold (≥20) */\n  isCrisis: boolean;\n  /** Suicidal ideation detected (Question 9 > 0) */\n  suicidalIdeation: boolean;\n  /** Suicidal ideation response value */\n  suicidalIdeationScore: AssessmentResponse;\n  /** Score validation results */\n  validation: ScoringValidation;\n  /** Clinical recommendations */\n  recommendations: ClinicalRecommendation[];\n  /** Calculation metadata */\n  metadata: ScoringMetadata;\n}\n\n/**\n * GAD-7 Scoring Result\n * Complete result with validation and clinical interpretation\n */\nexport interface GAD7ScoringResult {\n  /** Final calculated score (0-21) */\n  totalScore: number;\n  /** Individual question scores */\n  questionScores: Record<string, AssessmentResponse>;\n  /** Clinical severity interpretation */\n  severity: 'minimal' | 'mild' | 'moderate' | 'severe';\n  /** Whether score meets crisis threshold (≥15) */\n  isCrisis: boolean;\n  /** Score validation results */\n  validation: ScoringValidation;\n  /** Clinical recommendations */\n  recommendations: ClinicalRecommendation[];\n  /** Calculation metadata */\n  metadata: ScoringMetadata;\n}\n\n/**\n * Scoring Validation\n * Comprehensive validation of scoring accuracy\n */\nexport interface ScoringValidation {\n  /** Whether scoring is valid */\n  isValid: boolean;\n  /** Validation errors if any */\n  errors: ScoringValidationError[];\n  /** Warnings (non-blocking issues) */\n  warnings: ScoringValidationWarning[];\n  /** Data completeness check */\n  completeness: {\n    /** All required questions answered */\n    allQuestionsAnswered: boolean;\n    /** Missing question IDs */\n    missingQuestions: string[];\n    /** Invalid responses */\n    invalidResponses: Array<{\n      questionId: string;\n      response: unknown;\n      expectedRange: [number, number];\n    }>;\n  };\n  /** Clinical accuracy verification */\n  clinicalAccuracy: {\n    /** Algorithm implementation verified */\n    algorithmVerified: boolean;\n    /** Score calculation verified */\n    calculationVerified: boolean;\n    /** Threshold application verified */\n    thresholdVerified: boolean;\n  };\n}\n\n/**\n * Scoring Validation Error Types\n */\nexport type ScoringValidationError = \n  | {\n      type: 'MISSING_QUESTIONS';\n      message: string;\n      questionIds: string[];\n    }\n  | {\n      type: 'INVALID_RESPONSE';\n      message: string;\n      questionId: string;\n      response: unknown;\n      validRange: [number, number];\n    }\n  | {\n      type: 'CALCULATION_ERROR';\n      message: string;\n      expectedScore?: number;\n      actualScore?: number;\n    }\n  | {\n      type: 'THRESHOLD_ERROR';\n      message: string;\n      score: number;\n      thresholdType: 'severity' | 'crisis';\n    }\n  | {\n      type: 'ALGORITHM_ERROR';\n      message: string;\n      algorithmStep: string;\n    };\n\n/**\n * Scoring Validation Warning Types\n */\nexport type ScoringValidationWarning = \n  | {\n      type: 'UNUSUAL_PATTERN';\n      message: string;\n      pattern: string;\n    }\n  | {\n      type: 'RAPID_CHANGE';\n      message: string;\n      previousScore?: number;\n      currentScore: number;\n    }\n  | {\n      type: 'THRESHOLD_PROXIMITY';\n      message: string;\n      score: number;\n      threshold: number;\n    };\n\n/**\n * Clinical Recommendations\n */\nexport interface ClinicalRecommendation {\n  /** Recommendation type */\n  type: ClinicalRecommendationType;\n  /** Priority level */\n  priority: 'low' | 'moderate' | 'high' | 'urgent';\n  /** Recommendation message */\n  message: string;\n  /** Specific actions recommended */\n  actions: string[];\n  /** Whether immediate action required */\n  immediate: boolean;\n  /** Follow-up timeline */\n  followUp?: {\n    timeframe: string;\n    type: 'self_assessment' | 'clinical_check' | 'therapy_session';\n  };\n}\n\nexport type ClinicalRecommendationType = \n  | 'CRISIS_INTERVENTION'\n  | 'PROFESSIONAL_REFERRAL'\n  | 'THERAPY_RECOMMENDATION'\n  | 'SELF_CARE_STRATEGY'\n  | 'MEDICATION_REVIEW'\n  | 'FOLLOW_UP_ASSESSMENT'\n  | 'SAFETY_PLANNING'\n  | 'EMERGENCY_SERVICES';\n\n/**\n * Scoring Metadata\n */\nexport interface ScoringMetadata {\n  /** When scoring was calculated */\n  calculatedAt: number;\n  /** Algorithm version used */\n  algorithmVersion: string;\n  /** Calculation duration (ms) */\n  calculationTimeMs: number;\n  /** Assessment type */\n  assessmentType: AssessmentType;\n  /** Number of questions scored */\n  questionsScored: number;\n  /** Expected number of questions */\n  expectedQuestions: number;\n  /** Calculation method verification */\n  calculationMethod: 'standard' | 'validated' | 'clinical_verified';\n  /** Data source validation */\n  dataSourceVerified: boolean;\n}\n\n/**\n * Scoring Engine Interface\n */\nexport interface AssessmentScoringEngine {\n  /** Score PHQ-9 assessment */\n  scorePHQ9: PHQ9ScoringFunction;\n  /** Score GAD-7 assessment */\n  scoreGAD7: GAD7ScoringFunction;\n  /** Validate scoring input */\n  validateScoringInput: (\n    answers: AssessmentAnswer[], \n    type: AssessmentType\n  ) => ScoringValidation;\n  /** Calculate severity from score */\n  calculateSeverity: (\n    score: number, \n    type: AssessmentType\n  ) => string;\n  /** Check crisis thresholds */\n  checkCrisisThresholds: (\n    score: number, \n    type: AssessmentType, \n    answers?: AssessmentAnswer[]\n  ) => CrisisDetection | null;\n  /** Generate clinical recommendations */\n  generateRecommendations: (\n    result: PHQ9ScoringResult | GAD7ScoringResult\n  ) => ClinicalRecommendation[];\n  /** Verify calculation accuracy */\n  verifyCalculation: (\n    answers: AssessmentAnswer[], \n    result: PHQ9ScoringResult | GAD7ScoringResult\n  ) => boolean;\n}\n\n/**\n * Score Comparison Utilities\n */\nexport interface ScoreComparison {\n  /** Previous score for comparison */\n  previousScore?: number;\n  /** Current score */\n  currentScore: number;\n  /** Score change */\n  change: number;\n  /** Change direction */\n  direction: 'improved' | 'worsened' | 'stable';\n  /** Significance of change */\n  significance: 'minimal' | 'moderate' | 'significant' | 'substantial';\n  /** Clinical significance */\n  clinicallySignificant: boolean;\n  /** Change interpretation */\n  interpretation: string;\n}\n\n/**\n * Trend Analysis Types\n */\nexport interface ScoreTrend {\n  /** Assessment type */\n  assessmentType: AssessmentType;\n  /** Score history */\n  scores: Array<{\n    score: number;\n    timestamp: number;\n    severity: string;\n  }>;\n  /** Trend direction */\n  trend: 'improving' | 'declining' | 'stable' | 'fluctuating';\n  /** Trend strength */\n  strength: 'weak' | 'moderate' | 'strong';\n  /** Average change per assessment */\n  averageChange: number;\n  /** Volatility measure */\n  volatility: number;\n  /** Clinical interpretation */\n  clinicalInterpretation: string;\n}\n\n/**\n * Performance Requirements for Scoring\n */\nexport interface ScoringPerformanceRequirements {\n  /** Maximum calculation time (ms) */\n  readonly maxCalculationTimeMs: 50;\n  /** Maximum validation time (ms) */\n  readonly maxValidationTimeMs: 25;\n  /** Required accuracy percentage */\n  readonly requiredAccuracy: 100;\n  /** Maximum memory usage for calculation */\n  readonly maxMemoryUsageMB: 1;\n}\n\n/**\n * Type Guards for Scoring Results\n */\nexport function isPHQ9ScoringResult(\n  result: PHQ9ScoringResult | GAD7ScoringResult\n): result is PHQ9ScoringResult {\n  return 'suicidalIdeation' in result;\n}\n\nexport function isGAD7ScoringResult(\n  result: PHQ9ScoringResult | GAD7ScoringResult\n): result is GAD7ScoringResult {\n  return !('suicidalIdeation' in result);\n}\n\nexport function isCrisisScore(\n  score: number, \n  type: AssessmentType\n): boolean {\n  return type === 'phq9' ? score >= 20 : score >= 15;\n}\n\nexport function isValidAssessmentScore(\n  score: number, \n  type: AssessmentType\n): boolean {\n  const maxScore = type === 'phq9' ? 27 : 21;\n  return Number.isInteger(score) && score >= 0 && score <= maxScore;\n}\n\n/**\n * Scoring Configuration Constants\n */\nexport const PHQ9_SCORING_CONFIG: PHQ9ScoringConfig = {\n  questionCount: 9,\n  minScore: 0,\n  maxScore: 27,\n  responseRange: [0, 1, 2, 3],\n  severityThresholds: {\n    minimal: [0, 4],\n    mild: [5, 9],\n    moderate: [10, 14],\n    moderately_severe: [15, 19],\n    severe: [20, 27]\n  },\n  crisisThreshold: 20,\n  suicidalIdeationQuestionId: 'phq9_9'\n} as const;\n\nexport const GAD7_SCORING_CONFIG: GAD7ScoringConfig = {\n  questionCount: 7,\n  minScore: 0,\n  maxScore: 21,\n  responseRange: [0, 1, 2, 3],\n  severityThresholds: {\n    minimal: [0, 4],\n    mild: [5, 9],\n    moderate: [10, 14],\n    severe: [15, 21]\n  },\n  crisisThreshold: 15\n} as const;\n\n/**\n * Utility Type for Scoring Function Return Types\n */\nexport type ScoringResult<T extends AssessmentType> = \n  T extends 'phq9' ? PHQ9ScoringResult : GAD7ScoringResult;\n\n/**\n * Clinical Accuracy Validation Functions\n */\nexport interface ClinicalAccuracyValidator {\n  /** Validate PHQ-9 algorithm implementation */\n  validatePHQ9Algorithm: (\n    implementation: PHQ9ScoringFunction\n  ) => Promise<boolean>;\n  /** Validate GAD-7 algorithm implementation */\n  validateGAD7Algorithm: (\n    implementation: GAD7ScoringFunction\n  ) => Promise<boolean>;\n  /** Run comprehensive scoring tests */\n  runScoringTests: (\n    engine: AssessmentScoringEngine\n  ) => Promise<ScoringTestResults>;\n}\n\nexport interface ScoringTestResults {\n  /** Overall test success */\n  success: boolean;\n  /** Test completion timestamp */\n  timestamp: number;\n  /** PHQ-9 test results */\n  phq9Tests: {\n    passed: number;\n    failed: number;\n    accuracy: number;\n    errors: string[];\n  };\n  /** GAD-7 test results */\n  gad7Tests: {\n    passed: number;\n    failed: number;\n    accuracy: number;\n    errors: string[];\n  };\n  /** Performance metrics */\n  performance: {\n    averageCalculationTime: number;\n    maxCalculationTime: number;\n    memoryUsage: number;\n  };\n}"],"mappings":";;;;;;;;AAoYO,SAASA,mBAAmBA,CACjCC,MAA6C,EAChB;EAC7B,OAAO,kBAAkB,IAAIA,MAAM;AACrC;AAEO,SAASC,mBAAmBA,CACjCD,MAA6C,EAChB;EAC7B,OAAO,EAAE,kBAAkB,IAAIA,MAAM,CAAC;AACxC;AAEO,SAASE,aAAaA,CAC3BC,KAAa,EACbC,IAAoB,EACX;EACT,OAAOA,IAAI,KAAK,MAAM,GAAGD,KAAK,IAAI,EAAE,GAAGA,KAAK,IAAI,EAAE;AACpD;AAEO,SAASE,sBAAsBA,CACpCF,KAAa,EACbC,IAAoB,EACX;EACT,IAAME,QAAQ,GAAGF,IAAI,KAAK,MAAM,GAAG,EAAE,GAAG,EAAE;EAC1C,OAAOG,MAAM,CAACC,SAAS,CAACL,KAAK,CAAC,IAAIA,KAAK,IAAI,CAAC,IAAIA,KAAK,IAAIG,QAAQ;AACnE;AAKO,IAAMG,mBAAsC,GAAAC,OAAA,CAAAD,mBAAA,GAAG;EACpDE,aAAa,EAAE,CAAC;EAChBC,QAAQ,EAAE,CAAC;EACXN,QAAQ,EAAE,EAAE;EACZO,aAAa,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC3BC,kBAAkB,EAAE;IAClBC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;IACfC,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;IACZC,QAAQ,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC;IAClBC,iBAAiB,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC;IAC3BC,MAAM,EAAE,CAAC,EAAE,EAAE,EAAE;EACjB,CAAC;EACDC,eAAe,EAAE,EAAE;EACnBC,0BAA0B,EAAE;AAC9B,CAAU;AAEH,IAAMC,mBAAsC,GAAAZ,OAAA,CAAAY,mBAAA,GAAG;EACpDX,aAAa,EAAE,CAAC;EAChBC,QAAQ,EAAE,CAAC;EACXN,QAAQ,EAAE,EAAE;EACZO,aAAa,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC3BC,kBAAkB,EAAE;IAClBC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;IACfC,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;IACZC,QAAQ,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC;IAClBE,MAAM,EAAE,CAAC,EAAE,EAAE,EAAE;EACjB,CAAC;EACDC,eAAe,EAAE;AACnB,CAAU","ignoreList":[]}